<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliteCAD Tools - Revit Add-ins</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --bg: #0F0F12;
            --surface: #18181D;
            --surface2: #222229;
            --border: #2E2E38;
            --border-light: #3D3D4A;
            --text: #E8E8ED;
            --text-dim: #9898A8;
            --text-muted: #5A5A6A;

            --scan: #5ED5DD;
            --scan-dim: rgba(94, 213, 221, 0.12);
            --draft: #F5B878;
            --draft-dim: rgba(245, 184, 120, 0.12);
            --coord: #6EE7A8;
            --coord-dim: rgba(110, 231, 168, 0.12);
            --core: #A78BFA;
            --core-dim: rgba(167, 139, 250, 0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Dot grid background */
        .tech-grid-bg {
            background-image:
                linear-gradient(rgba(46, 46, 56, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(46, 46, 56, 0.15) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 28px;
            border-bottom: 1px solid var(--border);
            background: rgba(24, 24, 29, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--surface2), var(--bg));
            border: 1px solid var(--border-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
        }

        .logo-text h1 {
            font-size: 18px;
            font-weight: 700;
        }

        .logo-text h1 span {
            font-weight: 400;
            color: var(--text-dim);
        }

        .logo-text p {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.85); }
        }

        .status-text {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            padding: 10px 20px 0;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            position: relative;
            padding: 12px 28px;
            background: transparent;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab:hover {
            color: var(--text-dim);
            background: rgba(34, 34, 41, 0.5);
        }

        .tab.active {
            background: var(--surface);
            border-color: var(--border);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--surface);
        }

        .tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            border-radius: 2px 2px 0 0;
        }

        .tab.active[data-region="scan"] { color: var(--scan); }
        .tab.active[data-region="scan"]::before { background: var(--scan); }
        .tab.active[data-region="draft"] { color: var(--draft); }
        .tab.active[data-region="draft"]::before { background: var(--draft); }
        .tab.active[data-region="coord"] { color: var(--coord); }
        .tab.active[data-region="coord"]::before { background: var(--coord); }
        .tab.active[data-region="core"] { color: var(--core); }
        .tab.active[data-region="core"]::before { background: var(--core); }

        /* Ribbon */
        .ribbon {
            display: flex;
            height: 120px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            padding: 0 20px;
        }

        .ribbon::-webkit-scrollbar {
            height: 5px;
        }

        .ribbon::-webkit-scrollbar-track {
            background: transparent;
        }

        .ribbon::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .ribbon::-webkit-scrollbar-thumb:hover {
            background: var(--border-light);
        }

        .panel {
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            padding: 0 12px;
            min-width: max-content;
        }

        .panel-tools {
            display: flex;
            flex: 1;
            align-items: center;
            gap: 6px;
            padding: 8px 4px;
        }

        .panel-label {
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface);
            border-top: 1px solid var(--border);
            margin: 0 -8px;
            padding: 0 8px;
        }

        .panel-label span {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        /* Tool Button */
        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            width: 72px;
            height: 72px;
            padding: 6px 4px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tool-btn:hover {
            background: var(--surface2);
            border-color: var(--border);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .tool-btn.selected {
            border-color: var(--border-light);
        }

        .tool-btn .icon {
            width: 36px; /* Increased from 28px to showcase the detailed SVG */
            height: 36px;
            color: var(--text);
            transition: color 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tool-btn .icon svg {
            width: 100%;
            height: 100%;
        }

        .tool-btn .label {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 9px;
            font-weight: 500;
            color: var(--text);
            text-align: center;
            line-height: 1.1;
            max-width: 100%;
            overflow: hidden;
            margin-top: 4px;
        }

        /* Hover glow by region */
        [data-active-region="scan"] .tool-btn:hover { box-shadow: 0 2px 12px rgba(94, 213, 221, 0.15); }
        [data-active-region="draft"] .tool-btn:hover { box-shadow: 0 2px 12px rgba(245, 184, 120, 0.15); }
        [data-active-region="coord"] .tool-btn:hover { box-shadow: 0 2px 12px rgba(110, 231, 168, 0.15); }
        [data-active-region="core"] .tool-btn:hover { box-shadow: 0 2px 12px rgba(167, 139, 250, 0.15); }

        /* Selected states by region */
        [data-active-region="scan"] .tool-btn.selected { background: var(--scan-dim); border-color: var(--scan); box-shadow: 0 0 12px rgba(94, 213, 221, 0.2); }
        [data-active-region="scan"] .tool-btn.selected .icon { color: var(--scan); }
        [data-active-region="scan"] .tool-btn.selected .label { color: var(--scan); }

        [data-active-region="draft"] .tool-btn.selected { background: var(--draft-dim); border-color: var(--draft); box-shadow: 0 0 12px rgba(245, 184, 120, 0.2); }
        [data-active-region="draft"] .tool-btn.selected .icon { color: var(--draft); }
        [data-active-region="draft"] .tool-btn.selected .label { color: var(--draft); }

        [data-active-region="coord"] .tool-btn.selected { background: var(--coord-dim); border-color: var(--coord); box-shadow: 0 0 12px rgba(110, 231, 168, 0.2); }
        [data-active-region="coord"] .tool-btn.selected .icon { color: var(--coord); }
        [data-active-region="coord"] .tool-btn.selected .label { color: var(--coord); }

        [data-active-region="core"] .tool-btn.selected { background: var(--core-dim); border-color: var(--core); box-shadow: 0 0 12px rgba(167, 139, 250, 0.2); }
        [data-active-region="core"] .tool-btn.selected .icon { color: var(--core); }
        [data-active-region="core"] .tool-btn.selected .label { color: var(--core); }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .main-content.tech-grid-bg {
            padding: 32px;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1100px;
            margin: 0 auto;
            width: 100%;
        }

        /* Breadcrumb */
        .breadcrumb {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .breadcrumb .current {
            color: var(--text-dim);
        }

        /* Detail Card */
        .detail-card {
            flex: 1;
            display: flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .detail-main {
            flex: 1;
            padding: 36px;
            overflow-y: auto;
            animation: fadeIn 0.25s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 24px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .detail-icon {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
        }

        [data-active-region="scan"] .detail-icon { box-shadow: 0 0 20px rgba(94, 213, 221, 0.1); }
        [data-active-region="draft"] .detail-icon { box-shadow: 0 0 20px rgba(245, 184, 120, 0.1); }
        [data-active-region="coord"] .detail-icon { box-shadow: 0 0 20px rgba(110, 231, 168, 0.1); }
        [data-active-region="core"] .detail-icon { box-shadow: 0 0 20px rgba(167, 139, 250, 0.1); }

        .detail-icon svg {
            width: 100%;
            height: 100%;
        }
        
        /* Fallback for lucide icons in detail view */
        .detail-icon i {
            width: 48px;
            height: 48px;
        }

        .detail-title h2 {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }

        .detail-badges {
            display: flex;
            gap: 8px;
        }

        .badge {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            padding: 4px 10px;
            background: var(--surface2);
            color: var(--text-dim);
            text-transform: uppercase;
            border-radius: 4px;
        }

        .badge.active {
            background: var(--scan-dim);
            color: var(--scan);
        }

        [data-active-region="draft"] .badge.active { background: var(--draft-dim); color: var(--draft); }
        [data-active-region="coord"] .badge.active { background: var(--coord-dim); color: var(--coord); }
        [data-active-region="core"] .badge.active { background: var(--core-dim); color: var(--core); }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .detail-section h3 {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .detail-box {
            padding: 18px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-left: 3px solid var(--scan);
            border-radius: 0 6px 6px 0;
            height: 120px;
            overflow-y: auto;
        }

        .detail-box::-webkit-scrollbar {
            width: 5px;
        }

        .detail-box::-webkit-scrollbar-track {
            background: transparent;
        }

        .detail-box::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .detail-box::-webkit-scrollbar-thumb:hover {
            background: var(--border-light);
        }

        .detail-main::-webkit-scrollbar,
        .detail-sidebar::-webkit-scrollbar {
            width: 5px;
        }

        .detail-main::-webkit-scrollbar-track,
        .detail-sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .detail-main::-webkit-scrollbar-thumb,
        .detail-sidebar::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .detail-main::-webkit-scrollbar-thumb:hover,
        .detail-sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--border-light);
        }

        .detail-box-large {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-box-large p {
            color: var(--text-muted) !important;
            font-style: italic;
        }

        [data-active-region="draft"] .detail-box { border-left-color: var(--draft); }
        [data-active-region="coord"] .detail-box { border-left-color: var(--coord); }
        [data-active-region="core"] .detail-box { border-left-color: var(--core); }

        .detail-box p {
            font-size: 14px;
            line-height: 1.75;
            color: var(--text);
        }

        .detail-box.mono p {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-dim);
        }

        .detail-meta {
            display: flex;
            gap: 16px;
        }

        .meta-item {
            flex: 1;
            padding: 12px 16px;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meta-item .label {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .meta-item .value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text);
        }

        /* Sidebar */
        .detail-sidebar {
            width: 280px;
            background: var(--bg);
            border-left: 1px solid var(--border);
            padding: 24px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-title {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .sidebar-props {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .prop {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .prop .label {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
        }

        .prop .value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text);
        }

        .prop .color-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Download Section */
        .download-section {
            margin-top: auto;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .download-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px;
            background: var(--scan);
            color: var(--bg);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            text-decoration: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .download-btn:hover {
            filter: brightness(1.1);
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(94, 213, 221, 0.3);
        }

        [data-active-region="draft"] .download-btn:hover { box-shadow: 0 4px 16px rgba(245, 184, 120, 0.3); }
        [data-active-region="coord"] .download-btn:hover { box-shadow: 0 4px 16px rgba(110, 231, 168, 0.3); }
        [data-active-region="core"] .download-btn:hover { box-shadow: 0 4px 16px rgba(167, 139, 250, 0.3); }

        [data-active-region="draft"] .download-btn { background: var(--draft); }
        [data-active-region="coord"] .download-btn { background: var(--coord); }
        [data-active-region="core"] .download-btn { background: var(--core); }

        .download-btn i {
            width: 18px;
            height: 18px;
        }

        .download-version {
            margin-bottom: 8px;
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .download-info {
            margin-top: 12px;
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
        }

        .download-btn.disabled {
            background: var(--surface2);
            color: var(--text-muted);
            border: 1px solid var(--border);
            cursor: not-allowed;
            pointer-events: none;
            opacity: 0.6;
        }

        .download-btn.disabled:hover {
            filter: none;
            transform: none;
            box-shadow: none;
        }

        /* Requirements Section */
        .requirements-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .requirements-title {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .requirements-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .requirement-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.4;
        }

        .requirement-item svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            margin-top: 2px;
            stroke-width: 2;
        }

        .requirement-item span {
            line-height: 1.4;
        }

        .requirements-empty {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            opacity: 0.5;
        }

        .empty-state i {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
        }

        .empty-state span {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Release info */
        .release-info {
            padding: 24px;
        }

        .release-info h2 {
            font-family: 'Space Mono', monospace;
            font-size: 22px;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 16px 0;
        }

        .release-info h3 {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            margin: 20px 0 8px 0;
        }

        .release-info p {
            font-size: 13px;
            color: var(--text-dim);
            line-height: 1.6;
            margin: 0 0 8px 0;
        }

        .release-info strong {
            color: var(--text);
        }

        .release-info ol,
        .release-info ul {
            padding-left: 20px;
            margin: 0;
        }

        .release-info ul {
            list-style: disc;
        }

        .release-info ol li,
        .release-info ul li {
            font-size: 13px;
            color: var(--text-dim);
            line-height: 1.8;
        }

        .release-info ul li a {
            color: var(--scan);
            text-decoration: none;
        }

        .release-info ul li a:hover {
            text-decoration: underline;
        }

        .release-info code {
            display: inline-block;
            margin-top: 4px;
            padding: 6px 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text);
            word-break: break-all;
        }

        @media (max-width: 900px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
            .detail-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app" data-active-region="scan">
        <!-- Header -->
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i data-lucide="box" style="width: 18px; height: 18px;"></i>
                </div>
                <div class="logo-text">
                    <h1>EliteCAD<span>Tools</span></h1>
                    <p>Ribbon Configuration System v1.0</p>
                </div>
            </div>
            <div class="header-right">
                <div class="status">
                    <div class="status-dot" style="background: var(--scan);"></div>
                    <span class="status-text">System Active</span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-region="scan">ELITE SCAN</button>
            <button class="tab" data-region="draft">ELITE DRAFT</button>
            <button class="tab" data-region="coord">ELITE COORD</button>
            <button class="tab" data-region="core">ELITE CORE</button>
        </div>

        <!-- Ribbon -->
        <div class="ribbon" id="ribbon">
            <!-- Populated by JS -->
        </div>

        <!-- Main Content -->
        <div class="main-content tech-grid-bg">
            <div class="content-wrapper">
                <div class="breadcrumb">
                    <span id="breadcrumb-region">ELITE SCAN</span> / <span class="current" id="breadcrumb-tool">Overview</span>
                </div>

                <div class="detail-card">
                    <div class="detail-main" id="detail-main">
                        <!-- Populated by JS -->
                    </div>

                    <div class="detail-sidebar">
                        <h4 class="sidebar-title">Properties</h4>
                        <div class="sidebar-props">
                            <div class="prop">
                                <span class="label">Status</span>
                                <span class="value">Production Ready</span>
                            </div>
                            <div class="prop">
                                <span class="label">Add-in</span>
                                <span class="value" id="sidebar-addin">EliteScan</span>
                            </div>
                            <div class="prop">
                                <span class="label">Revit Versions</span>
                                <span class="value">2022 - 2026</span>
                            </div>
                        </div>

                        <div class="requirements-section" id="requirements-section">
                            <h4 class="requirements-title">Requirements</h4>
                            <div class="requirements-list" id="requirements-list">
                                <span class="requirements-empty">Select a tool to view requirements</span>
                            </div>
                        </div>

                        <div class="download-section">
                            <p class="download-version" id="download-version">v1.2.3</p>
                            <a href="https://github.com/kamditis/kamditis.github.io/releases/download/EliteScan-latest/EliteScan-v1.2.3.zip" class="download-btn" id="download-btn">
                                <i data-lucide="download"></i>
                                <span>Download</span>
                            </a>
                            <p class="download-info" id="download-info">EliteScan-v1.2.3.zip</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CUSTOM ICON SYSTEM (Imported from EliteRibbons) ---
        
        const customIcons = [
            // --- SCAN ---
            { id: 'Settings', group: 'scan', path: '<g transform="translate(28,36) rotate(45) scale(1.25) translate(-32,-32)"><path d="M 29 54 L 29 28 Q 29 22 20 20 L 20 8 L 26 8 L 26 16 Q 32 20 38 16 L 38 8 L 44 8 L 44 20 Q 35 22 35 28 L 35 54 A 3 3 0 0 1 29 54 Z" fill="none" stroke-width="5" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor"/></g>' },
            { id: 'PlaceScans', group: 'scan', path: '<circle cx="32" cy="32" r="20" stroke="currentColor" stroke-width="5" fill="none"/><path d="M32 3V9 M32 55V61 M3 32H9 M55 32H61" stroke="currentColor" stroke-width="5" stroke-linecap="round"/><circle cx="32" cy="32" r="10" fill="white"/>' },
            { id: 'RunAnalysis', group: 'scan', path: '<path d="M20 2V46L52 24Z" fill="currentColor" stroke="none"/><path d="M3 55H62" stroke="white" stroke-width="5" stroke-dasharray="2 2"/>' },
            { id: 'ViewReport', group: 'scan', path: '<rect x="4" y="2" width="56" height="58" rx="3" stroke="currentColor" stroke-width="5" fill="none"/><path d="M10 11H54 M10 20H54 M10 29H36.4" stroke="white" stroke-width="5"/><circle cx="46" cy="46" r="9" fill="#5A5A6A"/>' },
            { id: '360Viewer', group: 'scan', path: '<circle cx="32" cy="32" r="29" stroke="currentColor" stroke-width="5" fill="none"/><path d="M3 32H61 M32 3V61" stroke="white" stroke-width="5"/><path d="M32 15.47C40.41 15.47 48.53 23.59 48.53 32C48.53 40.41 40.41 48.53 32 48.53" stroke="white" stroke-width="5" fill="none"/>' },
            { id: 'ShowOverlay', group: 'scan', path: '<path d="M32 4L55 14L32 24L9 14Z" stroke="currentColor" stroke-width="5" fill="currentColor" fill-opacity="0.5"/><path d="M9 30L32 40L55 30" stroke="white" stroke-width="5" fill="none"/><path d="M9 46L32 56L55 46" stroke="currentColor" stroke-width="5" fill="none"/>' },
            { id: 'ClearOverlay', group: 'scan', path: '<path d="M32 6L54 16L32 26L10 16Z" stroke="white" stroke-width="5" fill="none"/><path d="M10 33L32 43L54 33" stroke="white" stroke-width="5" fill="none"/><path d="M4 59L59 4" stroke="currentColor" stroke-width="7" stroke-linecap="round"/>' },
            { id: 'Revit2ReCap', group: 'scan', path: '<rect x="3" y="16" width="29" height="29" stroke="white" stroke-width="5" fill="none"/><circle cx="51" cy="33" r="4" fill="currentColor"/><circle cx="58" cy="18" r="4" fill="currentColor"/><circle cx="41" cy="11" r="4" fill="currentColor"/><circle cx="55" cy="51" r="4" fill="currentColor"/><path d="M34 32H41" stroke="white" stroke-width="5"/>' },
            { id: 'CloudReset', group: 'scan', path: '<path d="M20.7 58.7 A29 29 0 1 1 49.5 55.2" stroke="currentColor" stroke-width="5" stroke-linecap="round" fill="none"/><path d="M18.4 53.1L20.7 58.7L15.1 60.9" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" fill="none"/><circle cx="32" cy="32" r="3" fill="white"/><circle cx="38" cy="28" r="3" fill="white"/><circle cx="26" cy="36" r="3" fill="white"/>' },

            // --- DRAFT ---
            { id: 'HangerSettings', group: 'draft', path: '<path d="M32 1V30" stroke="currentColor" stroke-width="5"/><path d="M14 20H50" stroke="currentColor" stroke-width="5"/><path d="M14 20V40Q14 58 32 58Q50 58 50 40V20" stroke="currentColor" stroke-width="5" fill="none"/><g transform="translate(36, 39) rotate(45) scale(2) translate(-16, -16)"><path d="M 14 28 L 14 14 Q 14 10 10 9 L 10 4 L 12 4 L 12 7 Q 16 9 20 7 L 20 4 L 22 4 L 22 9 Q 18 10 18 14 L 18 28 A 2 2 0 0 1 14 28 Z" fill="none" stroke="white" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round"/></g>' },
            { id: 'TagSettings', group: 'draft', path: '<path d="M6 10L13 3H56V59H6Z" stroke="currentColor" stroke-width="5" fill="none"/><circle cx="15" cy="12" r="2" fill="#5A5A6A"/><g transform="translate(36, 39) rotate(45) scale(2) translate(-16, -16)"><path d="M 14 28 L 14 14 Q 14 10 10 9 L 10 4 L 12 4 L 12 7 Q 16 9 20 7 L 20 4 L 22 4 L 22 9 Q 18 10 18 14 L 18 28 A 2 2 0 0 1 14 28 Z" fill="none" stroke="white" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round"/></g>' },
            { id: 'SinglePipes', group: 'draft', path: '<path d="M32 1V30" stroke="white" stroke-width="5"/><path d="M14 20H50" stroke="currentColor" stroke-width="5"/><path d="M14 20V40Q14 58 32 58Q50 58 50 40V20" stroke="currentColor" stroke-width="5" fill="none"/>' },
            { id: 'PipeRack', group: 'draft', path: '<path d="M5 0V62 M58 0V62" stroke="currentColor" stroke-width="5"/><path d="M0 52H64" stroke="currentColor" stroke-width="5"/><circle cx="16" cy="42" r="5" stroke="white" stroke-width="5" fill="none"/><circle cx="32" cy="42" r="5" stroke="white" stroke-width="5" fill="none"/><circle cx="48" cy="42" r="5" stroke="white" stroke-width="5" fill="none"/>' },
            { id: 'DuctHangers', group: 'draft', path: '<rect x="3" y="2" width="2" height="59" stroke="currentColor" stroke-width="5" fill="none"/><rect x="59" y="2" width="2" height="59" stroke="currentColor" stroke-width="5" fill="none"/><path d="M5 8H59 M5 56H59" stroke="white" stroke-width="5"/><path d="M11 8L53 55 M11 55L53 8" stroke="white" stroke-width="1" opacity="1"/>' },
            { id: 'RackAdjustment', group: 'draft', path: '<rect x="2" y="28" width="59" height="8" fill="currentColor"/><path d="M32 5V58" stroke="white" stroke-width="5"/><path d="M24.67 16L32 5L39.33 16" stroke="white" stroke-width="5" fill="none"/><path d="M24.67 47L32 58L39.33 47" stroke="white" stroke-width="5" fill="none"/>' },
            { id: 'AuditHangers', group: 'draft', path: '<rect x="16" y="12" width="34" height="40" stroke="white" stroke-width="5" fill="none"/><path d="M24 33.2L29.4 38.6L42 26" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>' },
            { id: 'FillInfo', group: 'draft', path: '<path d="M57.5 6.5L47.9 25.3L38.7 16.1Z" fill="white"/><path d="M47.9 25.3L38.7 16.1L10.4 44.4L19.6 53.6Z" fill="currentColor"/><path d="M19.6 53.6L10.4 44.4L1.9 52.9L11.1 62.1Z" fill="#5A5A6A"/>' },
            { id: 'ElbowExtension', group: 'draft', path: '<rect x="3" y="3" width="33" height="3" stroke="currentColor" stroke-width="5" fill="none"/><rect x="56" y="28" width="3" height="33" stroke="currentColor" stroke-width="5" fill="none"/><path d="M7 6V59H56" stroke="white" stroke-width="5" fill="none"/><path d="M32 6V31H56" stroke="white" stroke-width="5" fill="none"/>' },
            { id: 'Transition', group: 'draft', path: '<path d="M3 3H27L39 15H60V47H39L27 59H3V3Z" stroke="white" stroke-width="5" fill="none"/><line x1="27" y1="3" x2="27" y2="59" stroke="currentColor" stroke-width="1" stroke-dasharray="2 2"/>' },
            { id: 'BatchSpools', group: 'draft', path: '<rect x="3" y="18" width="42" height="42" fill="#222" stroke="currentColor" stroke-width="5"/><rect x="10.5" y="10.5" width="42" height="42" fill="#222" stroke="#5A5A6A" stroke-width="5"/><rect x="18" y="3" width="42" height="42" fill="#222" stroke="white" stroke-width="5"/>' },
            { id: 'Renumber', group: 'draft', path: '<text x="18" y="51" font-size="48" font-weight="bold" fill="white" font-family="sans-serif">#</text><path d="M31 7A27 27 0 1 1 4.59 28.39" stroke="currentColor" stroke-width="5" fill="none" stroke-linecap="round"/><path d="M31 2.5V7H35.5" stroke="currentColor" stroke-width="5" fill="none" stroke-linecap="round"/>' },
            { id: 'IsolateService', group: 'draft', path: '<path d="M3 32C3 32 11 12 31.5 12C52 12 60 32 60 32C60 32 52 52 31.5 52C11 52 3 32 3 32Z" stroke="white" stroke-width="5" fill="none"/><circle cx="31.5" cy="32" r="14" fill="currentColor"/>' },
            { id: 'HideService', group: 'draft', path: '<path d="M3 32C3 32 11 12 31.5 12C52 12 60 32 60 32C60 32 52 52 31.5 52C11 52 3 32 3 32Z" stroke="#5A5A6A" stroke-width="5" fill="none"/><line x1="10" y1="10" x2="54" y2="54" stroke="currentColor" stroke-width="12"/>' },
            { id: 'QuickTag', group: 'draft', path: '<path d="M6 10L13 3H56V59H6Z" stroke="currentColor" stroke-width="5" fill="none"/><circle cx="15" cy="12" r="3" fill="#5A5A6A"/><line x1="11" y1="22" x2="52" y2="22" stroke="white" stroke-width="5"/><line x1="11" y1="34" x2="52" y2="34" stroke="white" stroke-width="5"/>' },

            // --- COORD ---
            { id: 'DWGOverrides', group: 'coord', path: '<text x="1" y="42" font-size="22" font-weight="bold" fill="currentColor" font-family="sans-serif">DWG</text><g transform="translate(36, 39) rotate(45) scale(2) translate(-16, -16)"><path d="M 14 28 L 14 14 Q 14 10 10 9 L 10 4 L 12 4 L 12 7 Q 16 9 20 7 L 20 4 L 22 4 L 22 9 Q 18 10 18 14 L 18 28 A 2 2 0 0 1 14 28 Z" fill="none" stroke="white" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round"/></g>' },
            { id: 'MaterialMapping', group: 'coord', path: '<circle cx="32" cy="32" r="29" stroke="currentColor" stroke-width="5" fill="none"/><ellipse cx="32" cy="32" rx="13" ry="29" stroke="currentColor" stroke-width="5" fill="none"/><ellipse cx="32" cy="32" rx="29" ry="8" stroke="currentColor" stroke-width="5" fill="none"/><g transform="translate(36, 39) rotate(45) scale(2) translate(-16, -16)"><path d="M 14 28 L 14 14 Q 14 10 10 9 L 10 4 L 12 4 L 12 7 Q 16 9 20 7 L 20 4 L 22 4 L 22 9 Q 18 10 18 14 L 18 28 A 2 2 0 0 1 14 28 Z" fill="none" stroke="white" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round"/></g>' },
            { id: 'ApplyColors', group: 'coord', path: '<text x="1" y="42" font-size="22" font-weight="bold" fill="white" font-family="sans-serif">DWG</text><path d="M44 2L60 18L44 34" fill="currentColor" stroke="none"/>' },
            { id: 'ApplyMaterials', group: 'coord', path: '<circle cx="32" cy="32" r="29" stroke="white" stroke-width="5" fill="none"/><ellipse cx="32" cy="32" rx="13" ry="29" stroke="white" stroke-width="5" fill="none"/><ellipse cx="32" cy="32" rx="29" ry="8" stroke="white" stroke-width="5" fill="none"/><path d="M44 2L60 18L44 34" fill="currentColor" stroke="none"/>' },
            { id: 'CreateScopes', group: 'coord', path: '<rect x="12" y="12" width="40" height="40" stroke="white" stroke-width="5" stroke-dasharray="4 2" fill="none"/><line x1="12" y1="12" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="5"/><path d="M1.39 1.39L9.88 1.39L1.39 9.88Z" fill="currentColor"/><line x1="52" y1="12" x2="57.66" y2="6.34" stroke="currentColor" stroke-width="5"/><path d="M61.9 2.1L61.9 10.59L53.41 2.1Z" fill="currentColor"/><line x1="12" y1="52" x2="6.34" y2="57.66" stroke="currentColor" stroke-width="5"/><path d="M2.1 61.9L2.1 53.41L10.59 61.9Z" fill="currentColor"/><line x1="52" y1="52" x2="57.66" y2="57.66" stroke="currentColor" stroke-width="5"/><path d="M61.9 61.9L53.41 61.9L61.9 53.41Z" fill="currentColor"/>' },
            { id: 'ResetScope', group: 'coord', path: '<rect x="18" y="18" width="29" height="29" stroke="white" stroke-width="5" fill="none"/><path d="M32 4A28 28 0 1 1 8.52 16.75" stroke="currentColor" stroke-width="5" fill="none" stroke-dasharray="2 2"/><path d="M19.58 14.4L8.52 16.75L6.16 5.68" fill="currentColor" stroke="none"/>' },
            { id: 'ClashViewer', group: 'coord', path: '<rect x="3" y="3" width="49" height="49" stroke="white" stroke-width="5" fill="none"/><rect x="11" y="11" width="49" height="49" stroke="currentColor" stroke-width="5" fill="none"/><path d="M31.5 31.5L52 3M3 52L31.5 31.5" stroke="currentColor" stroke-width="5"/><circle cx="31.5" cy="31.5" r="12" fill="red"/>' },

            // --- CORE ---
            { id: 'SyncSettings', group: 'core', path: '<path d="M35.7 16.4 A16 16 0 0 1 35.7 47.6" stroke="currentColor" stroke-width="5" fill="none"/><path d="M28.3 47.6 A16 16 0 0 1 28.3 16.4" stroke="currentColor" stroke-width="5" fill="none"/><path d="M39.8 43.1 L35.7 47.6 L41.4 49.7" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" fill="none"/><path d="M24.2 20.9 L28.3 16.4 L22.6 14.3" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" fill="none"/><circle cx="32" cy="32" r="26" stroke="white" stroke-width="5" fill="none"/><path d="M32 6L32 3 M47.3 11L49 8.5 M56.7 24L59.6 23 M56.7 40L59.6 41 M47.3 53L49 55.5 M32 58L32 61 M16.7 53L15 55.5 M7.3 40L4.4 41 M7.3 24L4.4 23 M16.7 11L15 8.5" stroke="white" stroke-width="5" stroke-linecap="round"/>' },
            { id: 'SyncLog', group: 'core', path: '<path d="M3 3H47L60 16V60H3V3Z" stroke="white" stroke-width="5" fill="none"/><path d="M47 3V16H60" stroke="white" stroke-width="5" fill="none"/><line x1="9" y1="15" x2="34" y2="15" stroke="#5A5A6A" stroke-width="5"/><circle cx="44" cy="44" r="16" fill="#18181D" stroke="currentColor" stroke-width="5"/><path d="M44 36V44L50.4 50.4" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>' },
            { id: 'UserWorkset', group: 'core', path: '<circle cx="32" cy="20" r="17" stroke="white" stroke-width="5" fill="none"/><path d="M4 59C4 41 18 41 32 41C46 41 60 41 60 59" stroke="white" stroke-width="5" fill="none"/><rect x="37" y="40" width="16" height="16" rx="2" fill="currentColor" stroke="currentColor" stroke-width="5"/>' },
            { id: 'LinkWorksets', group: 'core', path: '<rect x="3" y="20" width="30" height="20" rx="10" stroke="white" stroke-width="5" fill="none"/><rect x="30" y="20" width="30" height="20" rx="10" stroke="#5A5A6A" stroke-width="5" fill="none"/><rect x="37" y="40" width="16" height="16" rx="2" fill="currentColor" stroke="currentColor" stroke-width="5"/>' },
        ];

        // MAPPING: Links App Tool IDs to Custom Icon IDs
        const ICON_MAP = {
            // Scan
            'settings': 'Settings',
            'place_scans': 'PlaceScans',
            'run_analysis': 'RunAnalysis',
            'view_report': 'ViewReport',
            '360_viewer': '360Viewer',
            '360_pane': '360Pane',
            'show_overlay': 'ShowOverlay',
            'clear_overlay': 'ClearOverlay',
            'revit_2_recap': 'Revit2ReCap',
            'cloud_reset': 'CloudReset',
            
            // Draft
            'hanger_settings': 'HangerSettings',
            'single_pipes': 'SinglePipes',
            'pipe_rack': 'PipeRack',
            'duct_hangers': 'DuctHangers',
            'rack_adjustment': 'RackAdjustment',

            'fill_info': 'FillInfo',
            'quick_tag': 'QuickTag',
            'tag_settings': 'TagSettings',
            'elbow_extension': 'ElbowExtension',
            'transition': 'Transition',
            'batch_spools': 'BatchSpools',
            'renumber': 'Renumber',
            'isolate_service': 'IsolateService',
            'hide_service': 'HideService',
            
            // Coord
            'dwg_overrides': 'DWGOverrides',
            'apply_colors': 'ApplyColors',
            'material_mapping': 'MaterialMapping',
            'apply_materials': 'ApplyMaterials',
            'create_scopes': 'CreateScopes',
            'reset_scope': 'ResetScope',
            'clash_viewer': 'ClashViewer',
            
            // Core
            'sync_settings': 'SyncSettings',
            'sync_log': 'SyncLog',
            'user_workset': 'UserWorkset',
            'link_worksets': 'LinkWorksets'
        };

        function createIconSVG(iconId, color) {
            const icon = customIcons.find(i => i.id === iconId);
            if (!icon) return null;

            return `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="100%" height="100%">
                <g style="color: ${color}">
                    ${icon.path}
                </g>
            </svg>`;
        }

        // Data
        const REGIONS = {
            scan: {
                id: 'scan',
                name: 'EliteScan',
                label: 'ELITE SCAN',
                color: '#5ED5DD',
                colorVar: 'var(--scan)',
                released: true,
                version: 'v1.2.3',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteScan-latest/EliteScan-v1.2.3.zip',
                downloadFile: 'EliteScan-v1.2.3.zip',
                description: 'Point cloud deviation analysis for Autodesk Revit.',
                installation: [
                    'Download the ZIP file.',
                    'Extract the ZIP.',
                    'Double-click <strong>Install.bat</strong>.',
                    'Select which Revit version(s) to install.',
                    'Restart Revit.'
                ],
                addinRequirements: [
                    '<a href="https://cloudcompare.org/" target="_blank">CloudCompare</a>',
                    'WebView2 runtime'
                ],
                panels: [
                    {
                        title: 'Analysis',
                        tools: [
                            { id: 'place_scans', label: 'Place Scans', icon: 'target', fn: 'Auto-places scan location markers at point cloud scan origins. Links each marker to its source scan for analysis tracking.', videoRef: 'GGQTLdprTyA', changelog: '', requirements: ['Point cloud linked in model (RCP/RCS)', 'Family: "Scan Location" loaded in project', 'Params on family: ScanID (text), PointCloudId (integer)', 'Levels defined in model'] },
                            { id: 'run_analysis', label: 'Run Analysis', icon: 'play', fn: 'Compares your Revit model against point cloud scans to verify installation accuracy. Grades each element A-F based on how closely the as-built matches design.', videoRef: '', changelog: '', requirements: ['Scan locations placed with ScanID populated', 'PointCloudId parameter linked to loaded point cloud', 'CloudCompare installed (auto-detected or set in Settings)'] },
                            { id: 'view_report', label: 'View Report', icon: 'file-text', fn: 'Opens the interactive results window showing which elements passed or failed quality checks. Drill down by discipline, category, or element to investigate deviations.', videoRef: '', changelog: '', requirements: ['Analysis completed (current session or saved results)'] },
                            { id: 'settings', label: 'Settings', icon: 'settings', fn: 'Configure analysis tolerance (how close is close enough), grading thresholds, and which element categories to include in quality checks.', videoRef: '', changelog: '', requirements: [] },
                        ]
                    },
                    {
                        title: 'Viewer',
                        tools: [
                            { id: '360_viewer', label: '360 Viewer', icon: 'globe', fn: 'View scan locations as interactive 360Â° panoramas with hotspot navigation between nearby scans. Sync the panorama view direction with Revit\'s 3D view for spatial context.', videoRef: '-glwNk8CL8c', changelog: '', requirements: ['Scan Location family instance selected', 'ScanID parameter populated', 'Support folder: "[PointCloudName] Support/"', 'Panorama image: [ScanID].jpg in support folder'] },
                        ]
                    },
                    {
                        title: 'Overlay',
                        tools: [
                            { id: 'show_overlay', label: 'Show Overlay', icon: 'layers', fn: 'Color-code elements in the active view by their accuracy grade (green = excellent, red = failed). Quickly spot problem areas without opening the full report.', videoRef: '', changelog: '', requirements: ['Analysis results (current session or saved)', 'Active view open'] },
                            { id: 'clear_overlay', label: 'Clear Overlay', icon: 'eye-off', fn: 'Remove color-coded deviation overlays from the current view to restore normal element appearance.', videoRef: '', changelog: '', requirements: ['Active view with overlay applied'] },
                        ]
                    },
                    {
                        title: 'Point Clouds',
                        tools: [
                            { id: 'revit_2_recap', label: 'Revit 2 ReCap', icon: 'share', fn: 'Extract point cloud transform data (position and rotation) for ReCap alignment. Displays coordinates and angles needed to align scans with your Revit model.', videoRef: '', changelog: '', requirements: ['Point cloud instance linked in model'] },
                            { id: 'cloud_reset', label: 'Cloud Reset', icon: 'refresh-cw', fn: 'Reset a selected point cloud\'s position and rotation back to origin. Useful for re-aligning scans after moving them in Revit.', videoRef: '', changelog: '', requirements: ['Point cloud instance to select when prompted'] },
                        ]
                    }
                ]
            },
            draft: {
                id: 'draft',
                name: 'EliteDraft',
                label: 'ELITE DRAFT',
                color: '#F5B878',
                colorVar: 'var(--draft)',
                released: true,
                version: 'v1.0.11',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteDraft-latest/EliteDraft-v1.0.11.zip',
                downloadFile: 'EliteDraft-v1.0.11.zip',
                description: 'MEP fabrication drafting tools for Autodesk Revit.',
                installation: [
                    'Download the ZIP file.',
                    'Extract the ZIP.',
                    'Double-click <strong>Install.bat</strong>.',
                    'Select which Revit version(s) to install.',
                    'Restart Revit.'
                ],
                addinRequirements: [],
                panels: [
                    {
                        title: 'Hangers',
                        tools: [
                            { id: 'hanger_settings', label: 'Hanger Settings', icon: 'wrench', fn: 'Configure rod sizes, spacing rules, and support families before placing hangers. Set defaults once, apply to all projects.', videoRef: '', changelog: 'v1.0.7: Added "Enable automatic clash detection" checkbox (off by default). When disabled, hangers are placed at ideal spacing without clash checks, significantly improving placement speed.', requirements: [] },
                            { id: 'single_pipes', label: 'Single Pipes', icon: 'anchor', fn: 'Automatically space individual pipe hangers based on code requirements and pipe size. Works on selected pipes or entire view.', videoRef: '', changelog: 'v1.0.8: Fixed hangers clustering near pipe ends when "Place at pipe ends" is enabled. Hangers are now evenly distributed along the pipe instead of bunching up at the end. v1.0.7: Fixed hangers being placed off-center on pipes slightly longer than one max span. Improved placement speed by removing unnecessary structural lookups during placement.', requirements: ['Fabrication pipes in model (straight, horizontal)', 'Hanger service button configured in Hanger Settings', 'Structural elements above pipes for attachment', 'A 3D view in project (for ray-casting)'] },
                            { id: 'pipe_rack', label: 'Pipe Rack', icon: 'grip-horizontal', fn: 'Create shared trapeze supports for grouped parallel pipes. Automatically detects runs that should hang together to save labor and material.', videoRef: '', changelog: 'v1.0.7: Fixed hangers being placed too close together when "Place at pipe ends" was unchecked. Pipes within one max span now get a single centered hanger instead of two at the edges. Pipes in the same rack no longer trigger false clash detections against each other.', requirements: ['Fabrication pipes in model (straight, horizontal)', 'Parallel pipes at same elevation', 'Trapeze hanger button configured in Hanger Settings', 'Structural elements above pipes for attachment', 'A 3D view in project (for ray-casting)'] },
                            { id: 'duct_hangers', label: 'Duct Hangers', icon: 'container', fn: 'Place hangers on straight duct runs with proper spacing per SMACNA. Handles both rectangular and round duct, individual or trapeze styles.', videoRef: '', changelog: 'v1.0.10: Transitions and open ends no longer force a 2 ft hanger offset â only elbows and branches require SMACNA clearances. Hangers on runs without fitting constraints are now evenly spaced across the full run. v1.0.9: Duct hangers now follow SMACNA 5.1.1 â hangers placed within 2 ft of elbows and 4 ft of branch taps. Fixed hangers landing on boot taps by detecting tap interference across duct segment junctions. Short runs now get properly offset hangers instead of a single midpoint hanger that could violate fitting clearances. Round duct spacing updated to 12 ft per SMACNA Table 5-2.', requirements: ['Fabrication ducts in model (straight, horizontal)', 'Duct hanger button configured in Hanger Settings', 'Structural elements above ducts for attachment', 'A 3D view in project (for ray-casting)'] },
                            { id: 'rack_adjustment', label: 'Rack Adjustment', icon: 'sliders-horizontal', fn: 'Realign existing trapeze hangers to match current pipe positions. Fixes width and elevation when pipes shift during coordination.', videoRef: '', changelog: '', requirements: ['Fabrication hangers selected (trapeze style)', 'Fabrication pipes selected'] },

                            { id: 'fill_info', label: 'Fill Info', icon: 'pencil', fn: 'Populate hanger family parameters with calculated values: rod lengths, elevation offsets, and sizes. Eliminates manual parameter entry for shop drawings.', videoRef: '', changelog: '', requirements: ['Fabrication hangers in model', 'Param: Hanger - Elevation Offset', 'Param: Hanger - Rod Length', 'Param: Hanger - Rod Length #2', 'Param: Hanger - Total Length', 'Param: Hanger - Unistrut Length', 'Param: Hanger - Free Size'] },
                        ]
                    },
                    {
                        title: 'Annotation',
                        tools: [
                            { id: 'quick_tag', label: 'Quick Tag', icon: 'tag', fn: 'Tag duct fittings with intelligent positioning based on fitting type. Configure once per fitting style, then batch-tag entire views.', videoRef: '', changelog: '', requirements: ['Fabrication duct fittings in view', 'Tag Settings configured with tag families', 'Tag families loaded in project', 'Active view supports tagging (not 3D/schedule)'] },
                            { id: 'tag_settings', label: 'Tag Settings', icon: 'settings-2', fn: 'Control where tags appear on straights, elbows, and transitions using a 3x3 grid system. Set offsets and tag families per fitting type.', videoRef: '', changelog: '', requirements: [] },
                            { id: 'elbow_extension', label: 'Elbow Extension', icon: 'corner-down-right', fn: 'Extract centerline-to-end dimensions from elbows and write to shared parameters for detailing. Shows takeoff lengths needed for fabrication.', videoRef: '', changelog: '', requirements: ['Fabrication duct fittings in view', 'Param: SM - Top Extension', 'Param: SM - Bottom Extension', 'Param: SM - Elbow Radius'] },
                            { id: 'transition', label: 'Transition', icon: 'filter', fn: 'Calculate and tag offset/set values for duct transitions. Automatically determines flat-top, flat-bottom, or bottom-up/down dimensions for fab notes.', videoRef: '', changelog: '', requirements: ['Fabrication duct fittings in view', 'Fitting Description: Transition, Radius Offset, Mitred Offset, or Square to Round', 'Param: SM - OFFSET (text)', 'Param: SM - SET (text)', 'Param: SM - CALC TRANSITION LENGTH (number)'] },
                            { id: 'batch_spools', label: 'Batch Spools', icon: 'list-ordered', fn: 'Generate complete spool sheet packages with ISO, plan, elevation views, and bill of materials. Creates fabrication-ready drawings from assemblies.', videoRef: '', changelog: 'v1.0.11: Redesigned as Spool Manager with 3-column dashboard layout. Added interactive sheet layout editor with zoomable canvas and pan support. Views now auto-scale based on sheet layout zone sizes. New template preset system to save, load, and delete named spool configurations. Tag family is now configurable instead of hardcoded. Smart 3D tag placement with collision avoidance.', requirements: ['Assemblies (spools) selected', 'View template: "ECD - SPOOL"', 'Title block: "ECD - Spool-11x17"', 'Tag family: "Item Number"', 'Param on parts: Spool - Description', 'Params on sheet: Spool - Weight, Spool - Weld Inches'] },
                            { id: 'renumber', label: 'Renumber', icon: 'hash', fn: 'Renumber spool item tags after changes. Groups identical parts under the same number and recalculates weight/weld totals for the BOM.', videoRef: '', changelog: '', requirements: ['Assemblies (spools) selected', 'Param on parts: Spool - Description', 'Params on sheet: Spool - Weight, Spool - Weld Inches'] },
                        ]
                    },
                    {
                        title: 'View',
                        tools: [
                            { id: 'isolate_service', label: 'Isolate Service', icon: 'eye', fn: 'Show only the selected system in the current view. Quickly focus on hot water, chilled water, or any service without manual filters.', videoRef: '', changelog: '', requirements: ['Fabrication parts in active view', 'Select or pick a fabrication part to identify the service'] },
                            { id: 'hide_service', label: 'Hide Service', icon: 'eye-off', fn: 'Hide the selected system in the current view. Clean up spool drawings by removing interfering systems outside the fabrication scope.', videoRef: '', changelog: '', requirements: ['Fabrication parts in active view', 'Pick a fabrication part to identify the service to hide'] },
                        ]
                    }
                ]
            },
            coord: {
                id: 'coord',
                name: 'EliteCoord',
                label: 'ELITE COORD',
                color: '#6EE7A8',
                colorVar: 'var(--coord)',
                released: true,
                version: 'v1.0.3',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteCoord-latest/EliteCoord-v1.0.3.zip',
                downloadFile: 'EliteCoord-v1.0.3.zip',
                description: 'BIM coordination tools for Autodesk Revit.',
                installation: [
                    'Download the ZIP file.',
                    'Extract the ZIP.',
                    'Double-click <strong>Install.bat</strong>.',
                    'Select which Revit version(s) to install.',
                    'Restart Revit.'
                ],
                addinRequirements: [],
                panels: [
                    {
                        title: 'Prep',
                        tools: [
                            { id: 'dwg_overrides', label: 'DWG Overrides', icon: 'file-output', fn: 'Define color and visibility rules for imported CAD layers to maintain consistent drawing standards across your project.', videoRef: '', changelog: '', requirements: [] },
                            { id: 'apply_colors', label: 'Apply Colors', icon: 'paintbrush', fn: 'Instantly color-code imported CAD layers in your view based on saved rules, making it easy to distinguish systems.', videoRef: '', changelog: '', requirements: ['DWG imports in active view', 'DWG Overrides configured'] },
                            { id: 'material_mapping', label: 'Material Mapping', icon: 'palette', fn: 'Assign colors to fabrication services that carry through to Navisworks, ensuring consistent clash detection visualization.', videoRef: '', changelog: '', requirements: ['Fabrication configuration loaded in Revit'] },
                            { id: 'apply_materials', label: 'Apply Materials', icon: 'wand', fn: 'Automatically apply configured materials to fabrication parts based on service or filter rules for coordination model consistency.', videoRef: '', changelog: '', requirements: ['Fabrication parts in model', 'Material Mapping configured', 'Shared parameter file set in Revit', 'Param: Navis Material (auto-created if missing)'] },
                        ]
                    },
                    {
                        title: 'Views',
                        tools: [
                            { id: 'create_scopes', label: 'Create Scopes', icon: 'box', fn: 'Generate level-specific 3D views with section boxes for streamlined coordination reviews and clash resolution.', videoRef: '', changelog: '', requirements: ['Levels defined in model', '3D view family type exists', 'Model geometry in view for bounding box'] },
                            { id: 'reset_scope', label: 'Reset Scope', icon: 'refresh-cw', fn: 'Quickly adjust your 3D view\'s section box to focus on specific levels, saving time during coordination.', videoRef: '', changelog: '', requirements: ['Active 3D view (non-perspective)', '0-2 levels selected (auto-detects upper bound)'] },
                        ]
                    },
                    {
                        title: 'Clash',
                        tools: [
                            { id: 'clash_viewer', label: 'Clash Viewer', icon: 'alert-triangle', fn: 'Import and visualize Navisworks clash results directly in Revit, tracking status and navigating to problem areas.', videoRef: '', changelog: '', requirements: ['Navisworks clash export XML file'] },
                        ]
                    }
                ]
            },
            core: {
                id: 'core',
                name: 'EliteCore',
                label: 'ELITE CORE',
                color: '#A78BFA',
                colorVar: 'var(--core)',
                released: true,
                version: 'v1.0.2',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteCore-latest/EliteCore-v1.0.2.zip',
                downloadFile: 'EliteCore-v1.0.2.zip',
                description: 'Project setup and shared utilities for Autodesk Revit.',
                installation: [
                    'Download the ZIP file.',
                    'Extract the ZIP.',
                    'Double-click <strong>Install.bat</strong>.',
                    'Select which Revit version(s) to install.',
                    'Restart Revit.'
                ],
                addinRequirements: [],
                panels: [
                    {
                        title: 'Project Setup',
                        tools: [
                            { id: 'user_workset', label: 'User Workset', icon: 'user', fn: 'Create a personal workset named after you to keep your work organized and prevent accidental edits to others\' elements.', videoRef: '', changelog: '', requirements: ['Worksharing enabled in project'] },
                            { id: 'link_worksets', label: 'Link Worksets', icon: 'link', fn: 'Organize linked models (RVT, CAD, point clouds) onto dedicated worksets for easier visibility control and model management.', videoRef: '', changelog: '', requirements: ['Worksharing enabled in project', 'Linked models, CAD files, or point clouds in project'] },
                        ]
                    },
                    {
                        title: 'AutoSync',
                        tools: [
                            { id: 'sync_settings', label: 'AutoSync Settings', icon: 'settings', fn: 'Configure automatic synchronization intervals, notification preferences, and sync behavior. Set how often your model syncs to central and control what happens during each sync cycle.', videoRef: '', changelog: 'v1.0.2: Added Auto-Sync feature with interval sync, idle sync, and sync-on-save modes. Configurable relinquish options and pre-close reminders. Sync timer now starts fresh from document open to prevent immediate sync. Removed separate Sync Now button.', requirements: ['Worksharing enabled in project', 'Central model accessible on network or BIM 360/ACC'] },
                            { id: 'sync_log', label: 'Sync Log', icon: 'clock', fn: 'View a timestamped history of all automatic and manual sync operations. Track sync durations, conflicts encountered, and elements borrowed or relinquished during each cycle.', videoRef: '', changelog: 'v1.0.2: New feature â tracks all sync operations with timestamps, sync type (interval, idle, manual, on-save), duration, and success/failure status.', requirements: ['Worksharing enabled in project', 'At least one sync operation completed'] },
                        ]
                    }
                ]
            }
        };

        // State
        let activeRegion = 'scan';
        let selectedTool = null;

        // Elements
        const app = document.querySelector('.app');
        const tabs = document.querySelectorAll('.tab');
        const ribbon = document.getElementById('ribbon');
        const detailMain = document.getElementById('detail-main');
        const breadcrumbRegion = document.getElementById('breadcrumb-region');
        const breadcrumbTool = document.getElementById('breadcrumb-tool');
        const sidebarAddin = document.getElementById('sidebar-addin');
        const downloadBtn = document.getElementById('download-btn');
        const downloadInfo = document.getElementById('download-info');
        const downloadVersion = document.getElementById('download-version');
        const statusDot = document.querySelector('.status-dot');
        const requirementsList = document.getElementById('requirements-list');

        // Functions
        function renderRibbon(regionId) {
            const region = REGIONS[regionId];
            ribbon.innerHTML = '';

            region.panels.forEach(panel => {
                const panelEl = document.createElement('div');
                panelEl.className = 'panel';

                const toolsEl = document.createElement('div');
                toolsEl.className = 'panel-tools';

                panel.tools.forEach(tool => {
                    const btn = document.createElement('button');
                    btn.className = 'tool-btn';
                    btn.dataset.toolId = tool.id;

                    const iconStyle = tool.rotate ? 'transform: rotate(180deg);' : '';
                    
                    // ICON SELECTION LOGIC
                    const customId = ICON_MAP[tool.id];
                    let iconContent = '';
                    
                    if (customId) {
                        const svg = createIconSVG(customId, region.color);
                        if (svg) {
                            iconContent = svg;
                        }
                    }
                    
                    if (!iconContent) {
                        // Fallback to lucide
                        iconContent = `<i data-lucide="${tool.icon}" class="icon" style="${iconStyle}"></i>`;
                    }

                    btn.innerHTML = `
                        <div class="icon" style="${iconStyle}">${iconContent}</div>
                        <span class="label">${tool.label}</span>
                    `;

                    btn.addEventListener('click', () => selectTool(tool));
                    toolsEl.appendChild(btn);
                });

                const labelEl = document.createElement('div');
                labelEl.className = 'panel-label';
                labelEl.innerHTML = `<span>${panel.title}</span>`;

                panelEl.appendChild(toolsEl);
                panelEl.appendChild(labelEl);
                ribbon.appendChild(panelEl);
            });

            lucide.createIcons();
        }

        function selectTool(tool) {
            selectedTool = tool;

            // Update selected state
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.toolId === tool.id);
            });

            // Update breadcrumb
            breadcrumbTool.textContent = tool.label;

            // Render detail
            renderDetail(tool);

            // Render requirements
            renderRequirements(tool);
        }

        function renderRequirements(tool) {
            const requirements = tool.requirements || [];

            if (requirements.length === 0) {
                requirementsList.innerHTML = '<span class="requirements-empty">No specific requirements</span>';
            } else {
                requirementsList.innerHTML = requirements.map(req => `
                    <div class="requirement-item">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        <span>${req}</span>
                    </div>
                `).join('');
            }
        }

        function renderDetail(tool) {
            const region = REGIONS[activeRegion];
            
            // Icon Generation
            const customId = ICON_MAP[tool.id];
            let iconContent = '';
            
            if (customId) {
                const svg = createIconSVG(customId, region.color);
                if (svg) {
                    iconContent = svg;
                }
            }
            
            if (!iconContent) {
                 iconContent = `<i data-lucide="${tool.icon}" ${tool.rotate ? 'style="transform: rotate(180deg);"' : ''}></i>`;
            }

            detailMain.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon" style="color: ${region.color};">
                        ${iconContent}
                    </div>
                    <div class="detail-title">
                        <h2>${tool.label}</h2>
                        <div class="detail-badges">
                            <span class="badge">ID: ${tool.id}</span>
                            <span class="badge active">ACTIVE</span>
                        </div>
                    </div>
                </div>

                <div class="detail-grid">
                    <div class="detail-section">
                        <h3>Function Description</h3>
                        <div class="detail-box">
                            <p>${tool.fn}</p>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>Changelog</h3>
                        <div class="detail-box mono">
                            <p>${tool.changelog || 'No changelog entries'}</p>
                        </div>
                    </div>
                </div>

                <div class="detail-section" style="margin-top: 24px;">
                    <h3>Video Reference</h3>
                    ${tool.videoRef
                        ? `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; border: 1px solid var(--border);">
                            <iframe src="https://www.youtube.com/embed/${tool.videoRef}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" allowfullscreen></iframe>
                           </div>`
                        : `<div class="detail-box detail-box-large mono"><p>No video reference available</p></div>`
                    }
                </div>
            `;

            lucide.createIcons();
        }

        function showReleaseInfo(region) {
            const version = region.version || '';
            const reqsHtml = region.addinRequirements && region.addinRequirements.length > 0
                ? `<h3>Requirements</h3><ul>${region.addinRequirements.map(r => `<li>${r}</li>`).join('')}</ul>`
                : '';

            detailMain.innerHTML = `
                <div class="release-info">
                    <h2>${region.name} ${version}</h2>
                    <p class="release-description">${region.description || ''}</p>
                    <p><strong>Supported Revit Versions:</strong> 2022, 2023, 2024, 2025, 2026</p>
                    <h3>Installation</h3>
                    <ol>${(region.installation || []).map(s => `<li>${s}</li>`).join('')}</ol>
                    ${reqsHtml}
                </div>
            `;
        }

        function switchRegion(regionId) {
            activeRegion = regionId;
            selectedTool = null;
            const region = REGIONS[regionId];

            // Update app data attribute
            app.dataset.activeRegion = regionId;

            // Update tabs
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.region === regionId);
            });

            // Update sidebar
            breadcrumbRegion.textContent = region.label;
            breadcrumbTool.textContent = 'Overview';
            sidebarAddin.textContent = region.name;
            statusDot.style.background = region.colorVar;

            // Update download
            if (region.released) {
                downloadBtn.href = region.downloadUrl;
                downloadBtn.classList.remove('disabled');
                downloadBtn.innerHTML = `<i data-lucide="download"></i><span>Download</span>`;
                downloadInfo.textContent = region.downloadFile;
                downloadVersion.textContent = region.version || '';
            } else {
                downloadBtn.removeAttribute('href');
                downloadBtn.classList.add('disabled');
                downloadBtn.innerHTML = `<i data-lucide="clock"></i><span>Coming Soon</span>`;
                downloadInfo.textContent = 'Release pending';
                downloadVersion.textContent = '';
            }

            // Render ribbon
            renderRibbon(regionId);

            // Show release info as default view
            showReleaseInfo(region);

            // Reset requirements to addin-level requirements
            if (region.addinRequirements && region.addinRequirements.length > 0) {
                requirementsList.innerHTML = region.addinRequirements
                    .map(r => `<div class="requirement-item"><i data-lucide="check-circle-2"></i><span>${r}</span></div>`)
                    .join('');
            } else {
                requirementsList.innerHTML = '<span class="requirements-empty">No additional requirements</span>';
            }

            lucide.createIcons();
        }

        // Event listeners
        tabs.forEach(tab => {
            tab.addEventListener('click', () => switchRegion(tab.dataset.region));
        });

        // Init
        switchRegion('scan');
    </script>
</body>
</html>
