<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliteCAD Tools - Revit Add-ins</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --bg: #0F0F12;
            --surface: #18181D;
            --surface2: #222229;
            --border: #2E2E38;
            --border-light: #3D3D4A;
            --text: #E8E8ED;
            --text-dim: #9898A8;
            --text-muted: #5A5A6A;

            --scan: #5ED5DD;
            --scan-dim: rgba(94, 213, 221, 0.12);
            --draft: #F5B878;
            --draft-dim: rgba(245, 184, 120, 0.12);
            --coord: #6EE7A8;
            --coord-dim: rgba(110, 231, 168, 0.12);
            --core: #A78BFA;
            --core-dim: rgba(167, 139, 250, 0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Dot grid background */
        .tech-grid-bg {
            background-image:
                linear-gradient(rgba(46, 46, 56, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(46, 46, 56, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--surface2), var(--bg));
            border: 1px solid var(--border-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
        }

        .logo-text h1 {
            font-size: 16px;
            font-weight: 700;
        }

        .logo-text h1 span {
            font-weight: 400;
            color: var(--text-dim);
        }

        .logo-text p {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            padding: 8px 16px 0;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            position: relative;
            padding: 10px 24px;
            background: transparent;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
        }

        .tab:hover {
            color: var(--text-dim);
        }

        .tab.active {
            background: var(--surface);
            border-color: var(--border);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--surface);
        }

        .tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
        }

        .tab.active[data-region="scan"] { color: var(--scan); }
        .tab.active[data-region="scan"]::before { background: var(--scan); }
        .tab.active[data-region="draft"] { color: var(--draft); }
        .tab.active[data-region="draft"]::before { background: var(--draft); }
        .tab.active[data-region="coord"] { color: var(--coord); }
        .tab.active[data-region="coord"]::before { background: var(--coord); }
        .tab.active[data-region="core"] { color: var(--core); }
        .tab.active[data-region="core"]::before { background: var(--core); }

        /* Ribbon */
        .ribbon {
            display: flex;
            height: 120px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            padding: 0 16px;
        }

        .ribbon::-webkit-scrollbar {
            height: 6px;
        }

        .ribbon::-webkit-scrollbar-track {
            background: var(--bg);
        }

        .ribbon::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .panel {
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            padding: 0 8px;
            min-width: max-content;
        }

        .panel-tools {
            display: flex;
            flex: 1;
            align-items: center;
            gap: 4px;
            padding: 8px 4px;
        }

        .panel-label {
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface);
            border-top: 1px solid var(--border);
            margin: 0 -8px;
            padding: 0 8px;
        }

        .panel-label span {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        /* Tool Button */
        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            width: 72px; /* Slightly wider for the new icons */
            height: 72px;
            padding: 6px 4px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .tool-btn:hover {
            background: var(--surface2);
            border-color: var(--border);
        }

        .tool-btn.selected {
            border-color: var(--border-light);
        }

        .tool-btn .icon {
            width: 36px; /* Increased from 28px to showcase the detailed SVG */
            height: 36px;
            color: var(--text);
            transition: color 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tool-btn .icon svg {
            width: 100%;
            height: 100%;
        }

        .tool-btn .label {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 9px;
            font-weight: 500;
            color: var(--text);
            text-align: center;
            line-height: 1.1;
            max-width: 100%;
            overflow: hidden;
            margin-top: 4px;
        }

        /* Selected states by region */
        [data-active-region="scan"] .tool-btn.selected { background: var(--scan-dim); border-color: var(--scan); }
        [data-active-region="scan"] .tool-btn.selected .icon { color: var(--scan); }
        [data-active-region="scan"] .tool-btn.selected .label { color: var(--scan); }

        [data-active-region="draft"] .tool-btn.selected { background: var(--draft-dim); border-color: var(--draft); }
        [data-active-region="draft"] .tool-btn.selected .icon { color: var(--draft); }
        [data-active-region="draft"] .tool-btn.selected .label { color: var(--draft); }

        [data-active-region="coord"] .tool-btn.selected { background: var(--coord-dim); border-color: var(--coord); }
        [data-active-region="coord"] .tool-btn.selected .icon { color: var(--coord); }
        [data-active-region="coord"] .tool-btn.selected .label { color: var(--coord); }

        [data-active-region="core"] .tool-btn.selected { background: var(--core-dim); border-color: var(--core); }
        [data-active-region="core"] .tool-btn.selected .icon { color: var(--core); }
        [data-active-region="core"] .tool-btn.selected .label { color: var(--core); }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .main-content.tech-grid-bg {
            padding: 32px;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1100px;
            margin: 0 auto;
            width: 100%;
        }

        /* Breadcrumb */
        .breadcrumb {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .breadcrumb .current {
            color: var(--text-dim);
        }

        /* Detail Card */
        .detail-card {
            flex: 1;
            display: flex;
            background: var(--surface);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .detail-main {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 24px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .detail-icon {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
        }

        .detail-icon svg {
            width: 100%;
            height: 100%;
        }
        
        /* Fallback for lucide icons in detail view */
        .detail-icon i {
            width: 48px;
            height: 48px;
        }

        .detail-title h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .detail-badges {
            display: flex;
            gap: 8px;
        }

        .badge {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            padding: 4px 10px;
            background: var(--surface2);
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .badge.active {
            background: var(--scan-dim);
            color: var(--scan);
        }

        [data-active-region="draft"] .badge.active { background: var(--draft-dim); color: var(--draft); }
        [data-active-region="coord"] .badge.active { background: var(--coord-dim); color: var(--coord); }
        [data-active-region="core"] .badge.active { background: var(--core-dim); color: var(--core); }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .detail-section h3 {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .detail-box {
            padding: 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 3px solid var(--scan);
            height: 120px;
            overflow-y: auto;
        }

        .detail-box::-webkit-scrollbar {
            width: 6px;
        }

        .detail-box::-webkit-scrollbar-track {
            background: var(--bg);
        }

        .detail-box::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .detail-box-large {
            height: 200px;
        }

        [data-active-region="draft"] .detail-box { border-left-color: var(--draft); }
        [data-active-region="coord"] .detail-box { border-left-color: var(--coord); }
        [data-active-region="core"] .detail-box { border-left-color: var(--core); }

        .detail-box p {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text);
        }

        .detail-box.mono p {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-dim);
        }

        .detail-meta {
            display: flex;
            gap: 16px;
        }

        .meta-item {
            flex: 1;
            padding: 12px 16px;
            background: var(--surface2);
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meta-item .label {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .meta-item .value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text);
        }

        /* Sidebar */
        .detail-sidebar {
            width: 280px;
            background: var(--bg);
            border-left: 1px solid var(--border);
            padding: 24px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-title {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .sidebar-props {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .prop {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .prop .label {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
        }

        .prop .value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text);
        }

        .prop .color-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Download Section */
        .download-section {
            margin-top: auto;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .download-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px;
            background: var(--scan);
            color: var(--bg);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
        }

        .download-btn:hover {
            filter: brightness(1.1);
        }

        [data-active-region="draft"] .download-btn { background: var(--draft); }
        [data-active-region="coord"] .download-btn { background: var(--coord); }
        [data-active-region="core"] .download-btn { background: var(--core); }

        .download-btn i {
            width: 18px;
            height: 18px;
        }

        .download-version {
            margin-bottom: 8px;
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .download-info {
            margin-top: 12px;
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
        }

        .download-btn.disabled {
            background: var(--surface2);
            color: var(--text-muted);
            cursor: not-allowed;
            pointer-events: none;
        }

        .download-btn.disabled:hover {
            filter: none;
        }

        /* Requirements Section */
        .requirements-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .requirements-title {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .requirements-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .requirement-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.4;
        }

        .requirement-item svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            margin-top: 2px;
            stroke-width: 2;
        }

        .requirement-item span {
            line-height: 1.4;
        }

        .requirements-empty {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            opacity: 0.5;
        }

        .empty-state i {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
        }

        .empty-state span {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Release info */
        .release-info {
            padding: 24px;
        }

        .release-info h2 {
            font-family: 'Space Mono', monospace;
            font-size: 22px;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 16px 0;
        }

        .release-info h3 {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            margin: 20px 0 8px 0;
        }

        .release-info p {
            font-size: 13px;
            color: var(--text-dim);
            line-height: 1.6;
            margin: 0 0 8px 0;
        }

        .release-info strong {
            color: var(--text);
        }

        .release-info ul {
            list-style: disc;
            padding-left: 20px;
            margin: 0;
        }

        .release-info ul li {
            font-size: 13px;
            color: var(--text-dim);
            line-height: 1.8;
        }

        .release-info ul li a {
            color: var(--scan);
            text-decoration: none;
        }

        .release-info ul li a:hover {
            text-decoration: underline;
        }

        @media (max-width: 900px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
            .detail-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app" data-active-region="scan">
        <!-- Header -->
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i data-lucide="box" style="width: 18px; height: 18px;"></i>
                </div>
                <div class="logo-text">
                    <h1>EliteCAD<span>Tools</span></h1>
                    <p>Ribbon Configuration System v1.0</p>
                </div>
            </div>
            <div class="header-right">
                <div class="status">
                    <div class="status-dot" style="background: var(--scan);"></div>
                    <span class="status-text">System Active</span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-region="scan">ELITE SCAN</button>
            <button class="tab" data-region="draft">ELITE DRAFT</button>
            <button class="tab" data-region="coord">ELITE COORD</button>
            <button class="tab" data-region="core">ELITE CORE</button>
        </div>

        <!-- Ribbon -->
        <div class="ribbon" id="ribbon">
            <!-- Populated by JS -->
        </div>

        <!-- Main Content -->
        <div class="main-content tech-grid-bg">
            <div class="content-wrapper">
                <div class="breadcrumb">
                    <span id="breadcrumb-region">ELITE SCAN</span> / <span class="current" id="breadcrumb-tool">Overview</span>
                </div>

                <div class="detail-card">
                    <div class="detail-main" id="detail-main">
                        <!-- Populated by JS -->
                    </div>

                    <div class="detail-sidebar">
                        <h4 class="sidebar-title">Properties</h4>
                        <div class="sidebar-props">
                            <div class="prop">
                                <span class="label">Status</span>
                                <span class="value">Production Ready</span>
                            </div>
                            <div class="prop">
                                <span class="label">Add-in</span>
                                <span class="value" id="sidebar-addin">EliteScan</span>
                            </div>
                            <div class="prop">
                                <span class="label">Revit Versions</span>
                                <span class="value">2022 - 2026</span>
                            </div>
                        </div>

                        <div class="requirements-section" id="requirements-section">
                            <h4 class="requirements-title">Requirements</h4>
                            <div class="requirements-list" id="requirements-list">
                                <span class="requirements-empty">Select a tool to view requirements</span>
                            </div>
                        </div>

                        <div class="download-section">
                            <p class="download-version" id="download-version">v1.2.0</p>
                            <a href="https://github.com/kamditis/kamditis.github.io/releases/download/EliteScan-latest/EliteScan-v1.2.1.zip" class="download-btn" id="download-btn">
                                <i data-lucide="download"></i>
                                <span>Download</span>
                            </a>
                            <p class="download-info" id="download-info">EliteScan-v1.2.1.zip</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CUSTOM ICON SYSTEM (Imported from EliteRibbons) ---
        
        // SYMMETRICAL WRENCH LOGIC
        const SYMMETRICAL_WRENCH_GROUP = `
            <g transform="rotate(45, 32, 32)">
                <path d="M 29 54 L 29 28 Q 29 22 20 20 L 20 8 L 26 8 L 26 16 Q 32 20 38 16 L 38 8 L 44 8 L 44 20 Q 35 22 35 28 L 35 54 A 3 3 0 0 1 29 54 Z" 
                    fill="none" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor" />
            </g>
        `;

        const BADGE_WRENCH_GROUP = (color) => `
            <g transform="translate(44, 44) rotate(45) translate(-16, -16)">
                 <path d="M 14 28 L 14 14 Q 14 10 10 9 L 10 4 L 12 4 L 12 7 Q 16 9 20 7 L 20 4 L 22 4 L 22 9 Q 18 10 18 14 L 18 28 A 2 2 0 0 1 14 28 Z"
                 fill="none" stroke="${color}" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round"/>
            </g>
        `;

        const customIcons = [
            // --- SCAN ---
            { id: 'Settings', group: 'scan', path: SYMMETRICAL_WRENCH_GROUP },
            { id: 'PlaceScans', group: 'scan', path: '<circle cx="32" cy="32" r="10" stroke="white" stroke-width="3" fill="none"/><path d="M32 10V20 M32 44V54 M10 32H20 M44 32H54" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><circle cx="32" cy="32" r="2" fill="currentColor"/>' },
            { id: 'RunAnalysis', group: 'scan', path: '<path d="M22 18V46L46 32L22 18Z" fill="white" stroke="none"/><path d="M12 50H52" stroke="currentColor" stroke-width="2" stroke-dasharray="2 2"/>' },
            { id: 'ViewReport', group: 'scan', path: '<rect x="18" y="14" width="28" height="36" rx="2" stroke="white" stroke-width="2" fill="none"/><path d="M24 24H40 M24 30H40 M24 36H32" stroke="#5A5A6A" stroke-width="2"/><circle cx="38" cy="40" r="4" fill="currentColor"/>' },
            { id: '360Viewer', group: 'scan', path: '<circle cx="32" cy="32" r="14" stroke="white" stroke-width="2" fill="none"/><path d="M18 32H46 M32 18V46" stroke="currentColor" stroke-width="1"/><path d="M32 24C36 24 40 28 40 32C40 36 36 40 32 40" stroke="currentColor" stroke-width="1"/>' },
            { id: '360Pane', group: 'scan', path: '<rect x="14" y="14" width="36" height="36" rx="2" stroke="white" stroke-width="2" fill="none"/><path d="M38 14V50" stroke="currentColor" stroke-width="2"/><circle cx="26" cy="32" r="6" stroke="currentColor" stroke-width="2" fill="none"/>' },
            { id: 'ShowOverlay', group: 'scan', path: '<path d="M32 14L50 24L32 34L14 24L32 14Z" stroke="white" stroke-width="2" fill="currentColor" fill-opacity="0.2"/><path d="M14 30L32 40L50 30" stroke="currentColor" stroke-width="2" fill="none"/><path d="M14 36L32 46L50 36" stroke="white" stroke-width="2" fill="none"/>' },
            { id: 'ClearOverlay', group: 'scan', path: '<path d="M32 14L50 24L32 34L14 24L32 14Z" stroke="#5A5A6A" stroke-width="2" fill="none"/><path d="M14 30L32 40L50 30" stroke="#5A5A6A" stroke-width="2" fill="none"/><path d="M18 46L46 18" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>' },
            { id: 'Revit2ReCap', group: 'scan', path: '<rect x="14" y="24" width="16" height="16" stroke="white" stroke-width="2" fill="none"/><circle cx="46" cy="32" r="2" fill="currentColor"/><circle cx="52" cy="28" r="2" fill="currentColor"/><circle cx="42" cy="26" r="2" fill="currentColor"/><circle cx="48" cy="38" r="2" fill="currentColor"/><path d="M32 32H38" stroke="currentColor" stroke-width="2"/>' },
            { id: 'CloudReset', group: 'scan', path: '<path d="M46 32A14 14 0 1 1 32 18" stroke="white" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M32 14V22L36 18L32 14Z" fill="currentColor"/><circle cx="32" cy="32" r="2" fill="currentColor"/><circle cx="38" cy="28" r="2" fill="currentColor"/><circle cx="26" cy="36" r="2" fill="currentColor"/>' },

            // --- DRAFT ---
            { id: 'HangerSettings', group: 'draft', path: '<path d="M26 10V26 M18 26H34 M18 26V40C18 46 34 46 34 40V26" stroke="white" stroke-width="2" fill="none"/>', badge: true },
            { id: 'TagSettings', group: 'draft', path: '<path d="M20 22 L30 12 H48 V46 H20 Z" stroke="white" stroke-width="2" fill="none"/><circle cx="29" cy="20" r="2" fill="white"/>', badge: true },
            { id: 'SinglePipes', group: 'draft', path: '<line x1="32" y1="12" x2="32" y2="36" stroke="currentColor" stroke-width="2"/><circle cx="32" cy="44" r="8" stroke="white" stroke-width="2" fill="none"/>' },
            { id: 'PipeRack', group: 'draft', path: '<path d="M14 12 V 48 M 50 12 V 48" stroke="currentColor" stroke-width="2" fill="none"/><line x1="10" y1="48" x2="54" y2="48" stroke="white" stroke-width="3"/><circle cx="20" cy="41" r="5" stroke="white" stroke-width="2" fill="none"/><circle cx="32" cy="41" r="5" stroke="white" stroke-width="2" fill="none"/><circle cx="44" cy="41" r="5" stroke="white" stroke-width="2" fill="none"/>' },
            { id: 'DuctHangers', group: 'draft', path: '<rect x="10" y="14" width="6" height="36" stroke="currentColor" stroke-width="2" fill="none"/><rect x="48" y="14" width="6" height="36" stroke="currentColor" stroke-width="2" fill="none"/><path d="M16 18H48M16 46H48" stroke="white" stroke-width="2"/><path d="M22 24L42 40M22 40L42 24" stroke="white" stroke-width="1" opacity="0.5"/>' },
            { id: 'RackAdjustment', group: 'draft', path: '<rect x="16" y="28" width="32" height="8" fill="#5A5A6A"/><path d="M32 20V44" stroke="currentColor" stroke-width="2"/><path d="M28 24L32 20L36 24" stroke="currentColor" stroke-width="2" fill="none"/><path d="M28 40L32 44L36 40" stroke="currentColor" stroke-width="2" fill="none"/>' },
            { id: 'AuditHangers', group: 'draft', path: '<path d="M20 16H44V48H20Z" stroke="white" stroke-width="2" fill="none"/><path d="M26 26L30 30L38 22" stroke="currentColor" stroke-width="2" fill="none"/>' },
            { id: 'FillInfo', group: 'draft', path: '<path d="M42 14L50 22L36 36L28 28L42 14Z" fill="white"/><path d="M36 36L28 28L22 46L26 48L36 36Z" fill="currentColor"/><rect x="18" y="44" width="16" height="4" fill="currentColor"/>' },
            { id: 'ElbowExtension', group: 'draft', path: '<rect x="16" y="8" width="24" height="6" stroke="currentColor" stroke-width="2" fill="none"/><rect x="50" y="24" width="6" height="24" stroke="currentColor" stroke-width="2" fill="none"/><path d="M20 14 V 44 H 50" stroke="white" stroke-width="2" fill="none"/><path d="M36 14 V 28 H 50" stroke="white" stroke-width="2" fill="none"/><path d="M26 14 Q 26 38 50 38" stroke="white" stroke-width="1" opacity="0.5" fill="none"/><path d="M32 14 Q 32 32 50 32" stroke="white" stroke-width="1" opacity="0.5" fill="none"/>' },
            { id: 'Transition', group: 'draft', path: '<path d="M16 16H24L36 24H48V40H36L24 48H16V16Z" stroke="white" stroke-width="2" fill="none"/><line x1="24" y1="16" x2="24" y2="48" stroke="currentColor" stroke-width="1" stroke-dasharray="2 2"/>' },
            { id: 'BatchSpools', group: 'draft', path: '<rect x="18" y="18" width="24" height="28" fill="#333" stroke="white" stroke-width="2"/><rect x="22" y="14" width="24" height="28" fill="#333" stroke="currentColor" stroke-width="2"/><rect x="26" y="10" width="24" height="28" fill="#333" stroke="white" stroke-width="2"/>' },
            { id: 'Renumber', group: 'draft', path: '<text x="24" y="40" font-size="24" font-weight="bold" fill="white" font-family="sans-serif">#</text><path d="M42 24A10 10 0 1 1 36 44" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M42 20V24H46" stroke="currentColor" stroke-width="2" fill="none"/>' },
            { id: 'IsolateService', group: 'draft', path: '<path d="M12 32C12 32 20 18 32 18C44 18 52 32 52 32C52 32 44 46 32 46C20 46 12 32 12 32Z" stroke="white" stroke-width="2" fill="none"/><circle cx="32" cy="32" r="6" fill="currentColor"/>' },
            { id: 'HideService', group: 'draft', path: '<path d="M12 32C12 32 20 18 32 18C44 18 52 32 52 32C52 32 44 46 32 46C20 46 12 32 12 32Z" stroke="#5A5A6A" stroke-width="2" fill="none"/><line x1="10" y1="10" x2="54" y2="54" stroke="currentColor" stroke-width="3"/>' },
            { id: 'QuickTag', group: 'draft', path: '<path d="M20 22 L30 12 H48 V46 H20 Z" stroke="white" stroke-width="2" fill="none"/><circle cx="29" cy="20" r="2" fill="white"/><line x1="28" y1="28" x2="42" y2="28" stroke="currentColor" stroke-width="2"/><line x1="28" y1="36" x2="42" y2="36" stroke="currentColor" stroke-width="2"/>' },

            // --- COORD ---
            { id: 'DWGOverrides', group: 'coord', path: '<path d="M16 42L48 42" stroke="white" stroke-width="2"/><path d="M16 34L48 34" stroke="white" stroke-width="2"/><path d="M16 26L36 26" stroke="white" stroke-width="2"/>', badge: true },
            { id: 'MaterialMapping', group: 'coord', path: '<rect x="16" y="24" width="32" height="24" stroke="white" stroke-width="2" fill="none"/><path d="M24 24V48 M32 24V48 M40 24V48" stroke="white" stroke-width="1"/>', badge: true },
            { id: 'ApplyDWG', group: 'coord', path: '<path d="M16 42L48 42" stroke="white" stroke-width="2"/><path d="M16 34L48 34" stroke="white" stroke-width="2"/><path d="M16 26L36 26" stroke="white" stroke-width="2"/><path d="M44 12L52 20L44 28" fill="currentColor" stroke="none"/>' },
            { id: 'ApplyMaterials', group: 'coord', path: '<rect x="16" y="24" width="32" height="24" stroke="white" stroke-width="2" fill="none"/><path d="M24 24V48 M32 24V48 M40 24V48" stroke="white" stroke-width="1"/><path d="M44 12L52 20L44 28" fill="currentColor" stroke="none"/>' },
            { id: 'CreateScopes', group: 'coord', path: '<rect x="18" y="18" width="28" height="28" stroke="white" stroke-width="2" stroke-dasharray="4 2" fill="none"/><path d="M10 10L18 18M54 10L46 18M10 54L18 46M54 54L46 46" stroke="currentColor" stroke-width="2"/>' },
            { id: 'ResetScope', group: 'coord', path: '<rect x="20" y="20" width="24" height="24" stroke="white" stroke-width="2" fill="none"/><path d="M32 14A18 18 0 1 1 14 32" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="2 2"/><path d="M32 10V18L36 14Z" fill="currentColor"/>' },
            { id: 'ClashViewer', group: 'coord', path: '<rect x="18" y="18" width="20" height="20" stroke="white" stroke-width="2" fill="none"/><rect x="26" y="26" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"/><path d="M32 32L42 22M22 42L32 32" stroke="currentColor" stroke-width="2"/><circle cx="32" cy="32" r="2" fill="red"/>' },

            // --- CORE ---
            { id: 'UserWorkset', group: 'core', path: '<circle cx="32" cy="24" r="8" stroke="white" stroke-width="2" fill="none"/><path d="M16 48C16 38 24 36 32 36C40 36 48 38 48 48" stroke="white" stroke-width="2" fill="none"/><rect x="36" y="40" width="16" height="12" rx="2" fill="currentColor" stroke="#18181D"/>' },
            { id: 'LinkWorksets', group: 'core', path: '<path d="M20 24H32A6 6 0 0 1 32 36H20A6 6 0 0 1 20 24" stroke="white" stroke-width="2" fill="none"/><path d="M44 24H32A6 6 0 0 0 32 36H44A6 6 0 0 0 44 24" stroke="currentColor" stroke-width="2" fill="none"/><rect x="36" y="40" width="16" height="12" rx="2" fill="#18181D" stroke="white"/>' },
        ];

        // MAPPING: Links App Tool IDs to Custom Icon IDs
        const ICON_MAP = {
            // Scan
            'settings': 'Settings',
            'place_scans': 'PlaceScans',
            'run_analysis': 'RunAnalysis',
            'view_report': 'ViewReport',
            '360_viewer': '360Viewer',
            '360_pane': '360Pane',
            'show_overlay': 'ShowOverlay',
            'clear_overlay': 'ClearOverlay',
            'revit_2_recap': 'Revit2ReCap',
            'cloud_reset': 'CloudReset',
            
            // Draft
            'hanger_settings': 'HangerSettings',
            'single_pipes': 'SinglePipes',
            'pipe_rack': 'PipeRack',
            'duct_hangers': 'DuctHangers',
            'rack_adjustment': 'RackAdjustment',
            'audit_hangers': 'AuditHangers',
            'fill_info': 'FillInfo',
            'quick_tag': 'QuickTag',
            'tag_settings': 'TagSettings',
            'elbow_extension': 'ElbowExtension',
            'transition': 'Transition',
            'batch_spools': 'BatchSpools',
            'renumber': 'Renumber',
            'isolate_service': 'IsolateService',
            'hide_service': 'HideService',
            
            // Coord
            'dwg_overrides': 'DWGOverrides',
            'apply_colors': 'ApplyDWG',
            'material_mapping': 'MaterialMapping',
            'apply_materials': 'ApplyMaterials',
            'create_scopes': 'CreateScopes',
            'reset_scope': 'ResetScope',
            'clash_viewer': 'ClashViewer',
            
            // Core
            'user_workset': 'UserWorkset',
            'link_worksets': 'LinkWorksets'
        };

        function createIconSVG(iconId, color) {
            const icon = customIcons.find(i => i.id === iconId);
            if (!icon) return null;

            // Background chips logic - kept outlines but removed solid fill for button integration
            return `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="100%" height="100%">
                <path d="M8 1H56L63 8V56L56 63H8L1 56V8L8 1Z" stroke="${color}" stroke-width="1" stroke-opacity="0.3" fill="none"/>
                <path d="M8 6H56" stroke="${color}" stroke-width="1" stroke-opacity="0.5" />
                <path d="M8 58H56" stroke="${color}" stroke-width="1" stroke-opacity="0.5" />
                <path d="M2 10L10 2" stroke="${color}" stroke-width="2" stroke-opacity="0.8" />
                <path d="M54 2L62 10" stroke="${color}" stroke-width="2" stroke-opacity="0.8" />
                <path d="M62 54L54 62" stroke="${color}" stroke-width="2" stroke-opacity="0.8" />
                <path d="M10 62L2 54" stroke="${color}" stroke-width="2" stroke-opacity="0.8" />
                
                <g style="color: ${color}">
                    ${icon.path}
                    ${icon.badge ? BADGE_WRENCH_GROUP(color) : ''}
                </g>
            </svg>`;
        }

        // Data
        const REGIONS = {
            scan: {
                id: 'scan',
                name: 'EliteScan',
                label: 'ELITE SCAN',
                color: '#5ED5DD',
                colorVar: 'var(--scan)',
                released: true,
                version: 'v1.2.0',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteScan-latest/EliteScan-v1.2.1.zip',
                downloadFile: 'EliteScan-v1.2.1.zip',
                description: 'Point cloud deviation analysis for Autodesk Revit.',
                installation: 'Download and extract the ZIP, then right-click Install-EliteScan.ps1 and select Run with PowerShell.',
                addinRequirements: [
                    '<a href="https://cloudcompare.org/" target="_blank">CloudCompare</a>',
                    'WebView2 runtime'
                ],
                panels: [
                    {
                        title: 'Analysis',
                        tools: [
                            { id: 'place_scans', label: 'Place Scans', icon: 'target', fn: 'Auto-places scan location markers at point cloud scan origins. Links each marker to its source scan for analysis tracking.', videoRef: 'GGQTLdprTyA', changelog: '', requirements: ['Point cloud linked in model (RCP/RCS)', 'Family: "Scan Location" loaded in project', 'Params on family: ScanID (text), PointCloudId (integer)', 'Levels defined in model'] },
                            { id: 'run_analysis', label: 'Run Analysis', icon: 'play', fn: 'Compares your Revit model against point cloud scans to verify installation accuracy. Grades each element A-F based on how closely the as-built matches design.', videoRef: '', changelog: '', requirements: ['Scan locations placed with ScanID populated', 'PointCloudId parameter linked to loaded point cloud', 'CloudCompare installed (auto-detected or set in Settings)'] },
                            { id: 'view_report', label: 'View Report', icon: 'file-text', fn: 'Opens the interactive results window showing which elements passed or failed quality checks. Drill down by discipline, category, or element to investigate deviations.', videoRef: '', changelog: '', requirements: ['Analysis completed (current session or saved results)'] },
                            { id: 'settings', label: 'Settings', icon: 'settings', fn: 'Configure analysis tolerance (how close is close enough), grading thresholds, and which element categories to include in quality checks.', videoRef: '', changelog: '', requirements: [] },
                        ]
                    },
                    {
                        title: 'Viewer',
                        tools: [
                            { id: '360_viewer', label: '360 Viewer', icon: 'globe', fn: 'View scan locations as interactive 360Â° panoramas with hotspot navigation between nearby scans. Sync the panorama view direction with Revit\'s 3D view for spatial context.', videoRef: '-glwNk8CL8c', changelog: '', requirements: ['Scan Location family instance selected', 'ScanID parameter populated', 'Support folder: "[PointCloudName] Support/"', 'Panorama image: [ScanID].jpg in support folder'] },
                        ]
                    },
                    {
                        title: 'Overlay',
                        tools: [
                            { id: 'show_overlay', label: 'Show Overlay', icon: 'layers', fn: 'Color-code elements in the active view by their accuracy grade (green = excellent, red = failed). Quickly spot problem areas without opening the full report.', videoRef: '', changelog: '', requirements: ['Analysis results (current session or saved)', 'Active view open'] },
                            { id: 'clear_overlay', label: 'Clear Overlay', icon: 'eye-off', fn: 'Remove color-coded deviation overlays from the current view to restore normal element appearance.', videoRef: '', changelog: '', requirements: ['Active view with overlay applied'] },
                        ]
                    },
                    {
                        title: 'Point Clouds',
                        tools: [
                            { id: 'revit_2_recap', label: 'Revit 2 ReCap', icon: 'share', fn: 'Extract point cloud transform data (position and rotation) for ReCap alignment. Displays coordinates and angles needed to align scans with your Revit model.', videoRef: '', changelog: '', requirements: ['Point cloud instance linked in model'] },
                            { id: 'cloud_reset', label: 'Cloud Reset', icon: 'refresh-cw', fn: 'Reset a selected point cloud\'s position and rotation back to origin. Useful for re-aligning scans after moving them in Revit.', videoRef: '', changelog: '', requirements: ['Point cloud instance to select when prompted'] },
                        ]
                    }
                ]
            },
            draft: {
                id: 'draft',
                name: 'EliteDraft',
                label: 'ELITE DRAFT',
                color: '#F5B878',
                colorVar: 'var(--draft)',
                released: true,
                version: 'v1.0.5',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteDraft-latest/EliteDraft-v1.0.5.zip',
                downloadFile: 'EliteDraft-v1.0.5.zip',
                description: 'MEP fabrication drafting tools for Autodesk Revit.',
                installation: 'Download and extract the ZIP, then right-click Install-EliteDraft.ps1 and select Run with PowerShell.',
                addinRequirements: [],
                panels: [
                    {
                        title: 'Hangers',
                        tools: [
                            { id: 'hanger_settings', label: 'Hanger Settings', icon: 'wrench', fn: 'Configure rod sizes, spacing rules, and support families before placing hangers. Set defaults once, apply to all projects.', videoRef: '', changelog: '', requirements: [] },
                            { id: 'single_pipes', label: 'Single Pipes', icon: 'anchor', rotate: true, fn: 'Automatically space individual pipe hangers based on code requirements and pipe size. Works on selected pipes or entire view.', videoRef: '', changelog: '', requirements: ['Fabrication pipes in model (straight, horizontal)', 'Hanger service button configured in Hanger Settings', 'Structural elements above pipes for attachment', 'A 3D view in project (for ray-casting)'] },
                            { id: 'pipe_rack', label: 'Pipe Rack', icon: 'grip-horizontal', fn: 'Create shared trapeze supports for grouped parallel pipes. Automatically detects runs that should hang together to save labor and material.', videoRef: '', changelog: '', requirements: ['Fabrication pipes in model (straight, horizontal)', 'Parallel pipes at same elevation', 'Trapeze hanger button configured in Hanger Settings', 'Structural elements above pipes for attachment', 'A 3D view in project (for ray-casting)'] },
                            { id: 'duct_hangers', label: 'Duct Hangers', icon: 'container', fn: 'Place hangers on straight duct runs with proper spacing per SMACNA. Handles both rectangular and round duct, individual or trapeze styles.', videoRef: '', changelog: '', requirements: ['Fabrication ducts in model (straight, horizontal)', 'Duct hanger button configured in Hanger Settings', 'Structural elements above ducts for attachment', 'A 3D view in project (for ray-casting)'] },
                            { id: 'rack_adjustment', label: 'Rack Adjustment', icon: 'sliders-horizontal', fn: 'Realign existing trapeze hangers to match current pipe positions. Fixes width and elevation when pipes shift during coordination.', videoRef: '', changelog: '', requirements: ['Fabrication hangers selected (trapeze style)', 'Fabrication pipes selected'] },
                            { id: 'audit_hangers', label: 'Audit Hangers', icon: 'clipboard-check', fn: 'Analyze hanger placement for coverage gaps, clash conflicts, and configuration issues. Generates a detailed troubleshooting report.', videoRef: '', changelog: '', requirements: ['Fabrication parts selected (pipes, ducts, or hangers)', 'Hanger Settings configured'] },
                            { id: 'fill_info', label: 'Fill Info', icon: 'pencil', fn: 'Populate hanger family parameters with calculated values: rod lengths, elevation offsets, and sizes. Eliminates manual parameter entry for shop drawings.', videoRef: '', changelog: '', requirements: ['Fabrication hangers in model', 'Param: Hanger - Elevation Offset', 'Param: Hanger - Rod Length', 'Param: Hanger - Rod Length #2', 'Param: Hanger - Total Length', 'Param: Hanger - Unistrut Length', 'Param: Hanger - Free Size'] },
                        ]
                    },
                    {
                        title: 'Annotation',
                        tools: [
                            { id: 'quick_tag', label: 'Quick Tag', icon: 'tag', fn: 'Tag duct fittings with intelligent positioning based on fitting type. Configure once per fitting style, then batch-tag entire views.', videoRef: '', changelog: '', requirements: ['Fabrication duct fittings in view', 'Tag Settings configured with tag families', 'Tag families loaded in project', 'Active view supports tagging (not 3D/schedule)'] },
                            { id: 'tag_settings', label: 'Tag Settings', icon: 'settings-2', fn: 'Control where tags appear on straights, elbows, and transitions using a 3x3 grid system. Set offsets and tag families per fitting type.', videoRef: '', changelog: '', requirements: [] },
                            { id: 'elbow_extension', label: 'Elbow Extension', icon: 'corner-down-right', fn: 'Extract centerline-to-end dimensions from elbows and write to shared parameters for detailing. Shows takeoff lengths needed for fabrication.', videoRef: '', changelog: '', requirements: ['Fabrication duct fittings in view', 'Param: SM - Top Extension', 'Param: SM - Bottom Extension', 'Param: SM - Elbow Radius'] },
                            { id: 'transition', label: 'Transition', icon: 'filter', fn: 'Calculate and tag offset/set values for duct transitions. Automatically determines flat-top, flat-bottom, or bottom-up/down dimensions for fab notes.', videoRef: '', changelog: '', requirements: ['Fabrication duct fittings in view', 'Fitting Description: Transition, Radius Offset, Mitred Offset, or Square to Round', 'Param: SM - OFFSET (text)', 'Param: SM - SET (text)', 'Param: SM - CALC TRANSITION LENGTH (number)'] },
                            { id: 'batch_spools', label: 'Batch Spools', icon: 'list-ordered', fn: 'Generate complete spool sheet packages with ISO, plan, elevation views, and bill of materials. Creates fabrication-ready drawings from assemblies.', videoRef: '', changelog: '', requirements: ['Assemblies (spools) selected', 'View template: "ECD - SPOOL"', 'Title block: "ECD - Spool-11x17"', 'Tag family: "Item Number"', 'Param on parts: Spool - Description', 'Params on sheet: Spool - Weight, Spool - Weld Inches'] },
                            { id: 'renumber', label: 'Renumber', icon: 'hash', fn: 'Renumber spool item tags after changes. Groups identical parts under the same number and recalculates weight/weld totals for the BOM.', videoRef: '', changelog: '', requirements: ['Assemblies (spools) selected', 'Param on parts: Spool - Description', 'Params on sheet: Spool - Weight, Spool - Weld Inches'] },
                        ]
                    },
                    {
                        title: 'View',
                        tools: [
                            { id: 'isolate_service', label: 'Isolate Service', icon: 'eye', fn: 'Show only the selected system in the current view. Quickly focus on hot water, chilled water, or any service without manual filters.', videoRef: '', changelog: '', requirements: ['Fabrication parts in active view', 'Select or pick a fabrication part to identify the service'] },
                            { id: 'hide_service', label: 'Hide Service', icon: 'eye-off', fn: 'Hide the selected system in the current view. Clean up spool drawings by removing interfering systems outside the fabrication scope.', videoRef: '', changelog: '', requirements: ['Fabrication parts in active view', 'Pick a fabrication part to identify the service to hide'] },
                        ]
                    }
                ]
            },
            coord: {
                id: 'coord',
                name: 'EliteCoord',
                label: 'ELITE COORD',
                color: '#6EE7A8',
                colorVar: 'var(--coord)',
                released: true,
                version: 'v1.0.0',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteCoord-latest/EliteCoord-v1.0.0.zip',
                downloadFile: 'EliteCoord-v1.0.0.zip',
                description: 'BIM coordination tools for Autodesk Revit.',
                installation: 'Download and extract the ZIP, then right-click Install-EliteCoord.ps1 and select Run with PowerShell.',
                addinRequirements: [],
                panels: [
                    {
                        title: 'Prep',
                        tools: [
                            { id: 'dwg_overrides', label: 'DWG Overrides', icon: 'file-output', fn: 'Define color and visibility rules for imported CAD layers to maintain consistent drawing standards across your project.', videoRef: '', changelog: '', requirements: [] },
                            { id: 'apply_colors', label: 'Apply Colors', icon: 'paintbrush', fn: 'Instantly color-code imported CAD layers in your view based on saved rules, making it easy to distinguish systems.', videoRef: '', changelog: '', requirements: ['DWG imports in active view', 'DWG Overrides configured'] },
                            { id: 'material_mapping', label: 'Material Mapping', icon: 'palette', fn: 'Assign colors to fabrication services that carry through to Navisworks, ensuring consistent clash detection visualization.', videoRef: '', changelog: '', requirements: ['Fabrication configuration loaded in Revit'] },
                            { id: 'apply_materials', label: 'Apply Materials', icon: 'wand', fn: 'Automatically apply configured materials to fabrication parts based on service or filter rules for coordination model consistency.', videoRef: '', changelog: '', requirements: ['Fabrication parts in model', 'Material Mapping configured', 'Shared parameter file set in Revit', 'Param: Navis Material (auto-created if missing)'] },
                        ]
                    },
                    {
                        title: 'Views',
                        tools: [
                            { id: 'create_scopes', label: 'Create Scopes', icon: 'box', fn: 'Generate level-specific 3D views with section boxes for streamlined coordination reviews and clash resolution.', videoRef: '', changelog: '', requirements: ['Levels defined in model', '3D view family type exists', 'Model geometry in view for bounding box'] },
                            { id: 'reset_scope', label: 'Reset Scope', icon: 'refresh-cw', fn: 'Quickly adjust your 3D view\'s section box to focus on specific levels, saving time during coordination.', videoRef: '', changelog: '', requirements: ['Active 3D view (non-perspective)', '0-2 levels selected (auto-detects upper bound)'] },
                        ]
                    },
                    {
                        title: 'Clash',
                        tools: [
                            { id: 'clash_viewer', label: 'Clash Viewer', icon: 'alert-triangle', fn: 'Import and visualize Navisworks clash results directly in Revit, tracking status and navigating to problem areas.', videoRef: '', changelog: '', requirements: ['Navisworks clash export XML file'] },
                        ]
                    }
                ]
            },
            core: {
                id: 'core',
                name: 'EliteCore',
                label: 'ELITE CORE',
                color: '#A78BFA',
                colorVar: 'var(--core)',
                released: true,
                version: 'v1.0.0',
                downloadUrl: 'https://github.com/kamditis/kamditis.github.io/releases/download/EliteCore-latest/EliteCore-v1.0.0.zip',
                downloadFile: 'EliteCore-v1.0.0.zip',
                description: 'Project setup and shared utilities for Autodesk Revit.',
                installation: 'Download and extract the ZIP, then right-click Install-EliteCore.ps1 and select Run with PowerShell.',
                addinRequirements: [],
                panels: [
                    {
                        title: 'Project Setup',
                        tools: [
                            { id: 'user_workset', label: 'User Workset', icon: 'user', fn: 'Create a personal workset named after you to keep your work organized and prevent accidental edits to others\' elements.', videoRef: '', changelog: '', requirements: ['Worksharing enabled in project'] },
                            { id: 'link_worksets', label: 'Link Worksets', icon: 'link', fn: 'Organize linked models (RVT, CAD, point clouds) onto dedicated worksets for easier visibility control and model management.', videoRef: '', changelog: '', requirements: ['Worksharing enabled in project', 'Linked models, CAD files, or point clouds in project'] },
                        ]
                    }
                ]
            }
        };

        // State
        let activeRegion = 'scan';
        let selectedTool = null;

        // Elements
        const app = document.querySelector('.app');
        const tabs = document.querySelectorAll('.tab');
        const ribbon = document.getElementById('ribbon');
        const detailMain = document.getElementById('detail-main');
        const breadcrumbRegion = document.getElementById('breadcrumb-region');
        const breadcrumbTool = document.getElementById('breadcrumb-tool');
        const sidebarAddin = document.getElementById('sidebar-addin');
        const downloadBtn = document.getElementById('download-btn');
        const downloadInfo = document.getElementById('download-info');
        const downloadVersion = document.getElementById('download-version');
        const statusDot = document.querySelector('.status-dot');
        const requirementsList = document.getElementById('requirements-list');

        // Functions
        function renderRibbon(regionId) {
            const region = REGIONS[regionId];
            ribbon.innerHTML = '';

            region.panels.forEach(panel => {
                const panelEl = document.createElement('div');
                panelEl.className = 'panel';

                const toolsEl = document.createElement('div');
                toolsEl.className = 'panel-tools';

                panel.tools.forEach(tool => {
                    const btn = document.createElement('button');
                    btn.className = 'tool-btn';
                    btn.dataset.toolId = tool.id;

                    const iconStyle = tool.rotate ? 'transform: rotate(180deg);' : '';
                    
                    // ICON SELECTION LOGIC
                    const customId = ICON_MAP[tool.id];
                    let iconContent = '';
                    
                    if (customId) {
                        const svg = createIconSVG(customId, region.color);
                        if (svg) {
                            iconContent = svg;
                        }
                    }
                    
                    if (!iconContent) {
                        // Fallback to lucide
                        iconContent = `<i data-lucide="${tool.icon}" class="icon" style="${iconStyle}"></i>`;
                    }

                    btn.innerHTML = `
                        <div class="icon" style="${iconStyle}">${iconContent}</div>
                        <span class="label">${tool.label}</span>
                    `;

                    btn.addEventListener('click', () => selectTool(tool));
                    toolsEl.appendChild(btn);
                });

                const labelEl = document.createElement('div');
                labelEl.className = 'panel-label';
                labelEl.innerHTML = `<span>${panel.title}</span>`;

                panelEl.appendChild(toolsEl);
                panelEl.appendChild(labelEl);
                ribbon.appendChild(panelEl);
            });

            lucide.createIcons();
        }

        function selectTool(tool) {
            selectedTool = tool;

            // Update selected state
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.toolId === tool.id);
            });

            // Update breadcrumb
            breadcrumbTool.textContent = tool.label;

            // Render detail
            renderDetail(tool);

            // Render requirements
            renderRequirements(tool);
        }

        function renderRequirements(tool) {
            const requirements = tool.requirements || [];

            if (requirements.length === 0) {
                requirementsList.innerHTML = '<span class="requirements-empty">No specific requirements</span>';
            } else {
                requirementsList.innerHTML = requirements.map(req => `
                    <div class="requirement-item">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        <span>${req}</span>
                    </div>
                `).join('');
            }
        }

        function renderDetail(tool) {
            const region = REGIONS[activeRegion];
            
            // Icon Generation
            const customId = ICON_MAP[tool.id];
            let iconContent = '';
            
            if (customId) {
                const svg = createIconSVG(customId, region.color);
                if (svg) {
                    iconContent = svg;
                }
            }
            
            if (!iconContent) {
                 iconContent = `<i data-lucide="${tool.icon}" ${tool.rotate ? 'style="transform: rotate(180deg);"' : ''}></i>`;
            }

            detailMain.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon" style="color: ${region.color};">
                        ${iconContent}
                    </div>
                    <div class="detail-title">
                        <h2>${tool.label}</h2>
                        <div class="detail-badges">
                            <span class="badge">ID: ${tool.id}</span>
                            <span class="badge active">ACTIVE</span>
                        </div>
                    </div>
                </div>

                <div class="detail-grid">
                    <div class="detail-section">
                        <h3>Function Description</h3>
                        <div class="detail-box">
                            <p>${tool.fn}</p>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>Changelog</h3>
                        <div class="detail-box mono">
                            <p>${tool.changelog || 'No changelog entries'}</p>
                        </div>
                    </div>
                </div>

                <div class="detail-section" style="margin-top: 24px;">
                    <h3>Video Reference</h3>
                    ${tool.videoRef
                        ? `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; border: 1px solid var(--border);">
                            <iframe src="https://www.youtube.com/embed/${tool.videoRef}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" allowfullscreen></iframe>
                           </div>`
                        : `<div class="detail-box detail-box-large mono"><p>No video reference available</p></div>`
                    }
                </div>
            `;

            lucide.createIcons();
        }

        function showReleaseInfo(region) {
            const version = region.version || '';
            const reqsHtml = region.addinRequirements && region.addinRequirements.length > 0
                ? `<h3>Requirements</h3><ul>${region.addinRequirements.map(r => `<li>${r}</li>`).join('')}</ul>`
                : '';

            detailMain.innerHTML = `
                <div class="release-info">
                    <h2>${region.name} ${version}</h2>
                    <p class="release-description">${region.description || ''}</p>
                    <p><strong>Supported Revit Versions:</strong> 2022, 2023, 2024, 2025, 2026</p>
                    <h3>Installation</h3>
                    <p>${region.installation || ''}</p>
                    ${reqsHtml}
                </div>
            `;
        }

        function switchRegion(regionId) {
            activeRegion = regionId;
            selectedTool = null;
            const region = REGIONS[regionId];

            // Update app data attribute
            app.dataset.activeRegion = regionId;

            // Update tabs
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.region === regionId);
            });

            // Update sidebar
            breadcrumbRegion.textContent = region.label;
            breadcrumbTool.textContent = 'Overview';
            sidebarAddin.textContent = region.name;
            statusDot.style.background = region.colorVar;

            // Update download
            if (region.released) {
                downloadBtn.href = region.downloadUrl;
                downloadBtn.classList.remove('disabled');
                downloadBtn.innerHTML = `<i data-lucide="download"></i><span>Download</span>`;
                downloadInfo.textContent = region.downloadFile;
                downloadVersion.textContent = region.version || '';
            } else {
                downloadBtn.removeAttribute('href');
                downloadBtn.classList.add('disabled');
                downloadBtn.innerHTML = `<i data-lucide="clock"></i><span>Coming Soon</span>`;
                downloadInfo.textContent = 'Release pending';
                downloadVersion.textContent = '';
            }

            // Render ribbon
            renderRibbon(regionId);

            // Show release info as default view
            showReleaseInfo(region);

            // Reset requirements to addin-level requirements
            if (region.addinRequirements && region.addinRequirements.length > 0) {
                requirementsList.innerHTML = region.addinRequirements
                    .map(r => `<div class="requirement-item"><i data-lucide="check-circle-2"></i><span>${r}</span></div>`)
                    .join('');
            } else {
                requirementsList.innerHTML = '<span class="requirements-empty">No additional requirements</span>';
            }

            lucide.createIcons();
        }

        // Event listeners
        tabs.forEach(tab => {
            tab.addEventListener('click', () => switchRegion(tab.dataset.region));
        });

        // Init
        switchRegion('scan');
    </script>
</body>
</html>
